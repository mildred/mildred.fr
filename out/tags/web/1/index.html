<!DOCTYPE html>
<html>
  <head>
    <title>Category: web - Mildred's Website</title>
    <meta charset='utf-8' />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type' />
    <meta content='' name='keywords' />
    <meta content='' name='description' />
    <meta content='initial-scale=1.0, width=device-width' name='viewport' />
    <meta content='tag' name='x-kind' />
    <link href='http://mildred.fr/tags/web/1/' rel='canonical' />
    <link href='../../../favicon.png' rel='icon' type='image/png' />
    <link href='../../../favicon.png' rel='shortcut icon' type='image/png' />
    <link href='../../../style.css' media='screen' rel='stylesheet' type='text/css' />
    <link href='../atom.xml' rel='alternate' title='ATOM Feed' type='application/atom+xml' />
    <link href='../rss.xml' rel='alternate' title='RSS Feed' type='application/rss+xml' />
    <script src='../../../Scripts/json/json2.js' type='text/javascript'></script>
    <script src='../../../Scripts/jquery.min.js' type='text/javascript'></script>
    <script src='../../../Scripts/comments.js' type='text/javascript'></script>
    <script src='../../../Scripts/local.js' type='text/javascript'></script>
  </head>
  <body>
    <div class="header">
      <p class="access-links">
        <a href="#menu">Go to Menu</a>
        <br />
        <a href="#content">Go to Content</a>
      </p>
      <div class="left">
        <a href="../../../">
          <img alt="My photo" class="photo" src="../../../Images/IMG_5669_square_128.jpeg" />
        </a>
      </div>
      <div class="title">
        <h1>
          <a href="../../../">Mildred's Website</a>
        </h1>
      </div>
      <div class="float-right"></div>
      <div class="clear-right"></div>
      <div class="right">
        <strong>Tags:</strong>
        <ul class="tags">
          <li>
            <a class="tag" href="../../cobra/">cobra</a>
          </li>
          <li>
            <a class="tag" href="../../comp/">comp</a>
          </li>
          <li>
            <a class="tag" href="../../configuration/">configuration</a>
          </li>
          <li>
            <a class="tag" href="../../dev/">dev</a>
          </li>
          <li>
            <a class="tag" href="../../dream/">dream</a>
          </li>
          <li>
            <a class="tag" href="../../en/">en</a>
          </li>
          <li>
            <a class="tag" href="../../fedora/">fedora</a>
          </li>
          <li>
            <a class="tag" href="../../fr/">fr</a>
          </li>
          <li>
            <a class="tag" href="../../freedombox/">freedombox</a>
          </li>
          <li>
            <a class="tag" href="../../git/">git</a>
          </li>
          <li>
            <a class="tag" href="../../html/">html</a>
          </li>
          <li>
            <a class="tag" href="../../idea/">idea</a>
          </li>
          <li>
            <a class="tag" href="../../liens/">liens</a>
          </li>
          <li>
            <a class="tag" href="../../lisaac/">lisaac</a>
          </li>
          <li>
            <a class="tag" href="../../lysaac/">lysaac</a>
          </li>
          <li>
            <a class="tag" href="../../misc/">misc</a>
          </li>
          <li>
            <a class="tag" href="../../photos/">photos</a>
          </li>
          <li>
            <a class="tag" href="../../physics/">physics</a>
          </li>
          <li>
            <a class="tag" href="../../politique/">politique</a>
          </li>
          <li>
            <a class="tag" href="../../privacy/">privacy</a>
          </li>
          <li>
            <a class="tag" href="../../srs/">srs</a>
          </li>
          <li>
            <a class="tag" href="../../test/">test</a>
          </li>
          <li>
            <a class="tag" href="../">web</a>
          </li>
          <li>
            <a class="tag" href="../../website/">website</a>
          </li>
          <li>
            <a class="tag" href="../../wwwgen/">wwwgen</a>
          </li>
          <li>
            <a class="tag" href="../../wwwsupport/">wwwsupport</a>
          </li>
        </ul>
      </div>
      <div class="content">
        <div class="links" id="menu">
          <ul>
            <li>
              <a href="../../../">Home</a>
            </li>
            <li>
              <a href="../../../Blog/">Blog</a>
            </li>
            <li>
              <a href="//survie.mildred.fr">Survie</a>
            </li>
          </ul>
        </div>
      </div>
      <div class="clear"></div>
    </div>
    <div class="leftcol">
      <img alt="My avatar" class="photo" src="../../../Images/all128.jpeg" />
      <hr />
      <p>GoogleTalk, Jabber, XMPP address:
      <br /><strong><a href="xmpp:mildred&#64;jabber.fr">mildred&#64;jabber.fr</a></strong><!--&nbsp;<img src="http://presence.jabberfr.org/2dc519ffec76a836c2f2c2f66ac38291/image-dcraven.png" alt="" /><br /><em><script type="text/javascript" src="http://presence.jabberfr.org/2dc519ffec76a836c2f2c2f66ac38291/message_js.js"></script></em>-->
      </p>
      <hr />
      <p>
        <a href="../../../gpg_key.txt">GPG Public Key</a>
        <br />
        <span style="font-size: 0.8em">
          (Fingerprint 197C A7E6 645B 4299 6D37 684B 6F9D A8D6 9A7D 2E2B)
        </span>
      </p>
    </div>
    <div class='main' id='content'>
      <h1>Category: web</h1>
      <p>Articles from 1 to 5</p>
      <div class='article-list'>
        <div class='sub-article'>
          <h2>
            <a class='permalink' href='../../../Blog/2011/08/05/html_2_0/'>HTML 2.0: Why I think HTML is broken</a>
          </h2>
          <div><p class='meta'>
  <span class='date-time'>
    <span class='date'>Fri 05 Aug 2011,</span>
    <span class='time'>10:35 AM</span>
  </span>
  <span class='author'>
    by
    <span class='author-name'>
      Shanti
    </span>
  </span>
  <span class='tags'>
    <span class='tag'>
      <a class='tag' href='../../comp/'>comp</a>
    </span>
    <span class='tag'>
      <a class='tag' href='../../en/'>en</a>
    </span>
    <span class='tag'>
      <a class='tag' href='../../html/'>html</a>
    </span>
    <span class='tag'>
      <a class='tag' href='../'>web</a>
    </span>
  </span>
</p>
<div class='excerpt'>
  <p>First postulate: HTML was designed as a stateless protocol</p>

<p>Context: web sites need to maintain a context (or state) to track the client.
This is required by the log-in procedures the various websites have. It is also
useful to track the user in a web store, to know which items the user wants to
buy. In fact, it is requires almost everywhere.</p>

<p>The first solution to be thrown out for this problem are the cookies. People
didn't like cookies but now, everyone accepts them. Nothing works without
cookies. Why did people dislike cookies back then? They liked their provacy and
cookies makes it possible to track the user. Through advertisement networks, the
advertiser known exactly which website the user visited. And it is still the
case now. What changed is that the users got tried to fight cookies and have
every website break, and they got used to it.</p>

<p><strong>People got used to being tracked</strong> just as people are used to be watched by
video cameras in the street and people are used to get tracked by the government
and big companies and banks.</p>

<p>Cookies are a great way to track prople, all because HTTP didn't include session
management. The way Google track you is very simple. Google Analytics puts a
cookie on your computer and each time you access the Google Server, they know
it's the same person. Google is everywhere:</p>

<ul>
<li>Many web sites are using Google APIs, or the jQuery library at Google.</li>
<li>Many web sites ask Google to track their users to know how many prople visit
their page.</li>
<li>Google makes advertisement.</li>
<li>Youtube, Blogger, Picasa and others are owned by Google</li>
</ul>


<p>With this alone, Google is found on almost every page. If you have an account at
Google (YouTube, Picase, Gmail, Blogger, Android or other), they can even give a
name or an e-mail address to all of these information.</p>

<p>Google motto is <em>Don't be Evil</em>, they are perhaps not evil but can they become
evil? Yes.</p>

<p>Whatever, my dream HTTP 2.0 protocol would include of course push support like
WebSockets, but more importantly: session management. How should this be done?</p>

<h3>HTTP and Session Management</h3>

<p><strong>When the server needs a session, it initiates the session by giving a session
token to the client.</strong> The client needs to protect this token from being stolen
and should display that a session is in pogress for this website. It could
appear on the URL bar for example. The client could close the session at any
moment.</p>

<p>With the token, the server provides its validity scope. Domains, subdomains,
path. Only the resources in the session scope will receive the tocken back. If
for example <code>http://example.com</code> starts a session at <code>example.com</code> but have an
<code>&lt;iframe&gt;</code> that includes facebook. Facebook won't receive the session token. If
Facebook wants to start a session (because the user wants to log-in) it will
start a second session.</p>

<p>Session cannot escape the page. If you have two tabs open with facebook in each
tab (either full page or embedded), the two facebook instances don't share the
same session, unless the user explicitely allowed this. For instance, when
Facebook starts a session, the browser could tell the user that Facebook already
have an existing session and the user would be free to choose between the new
session and the existing one.</p>

<h3>How does this solve XSS</h3>

<p>XSS is when a website you don't trust access the session of a website you trust,
and steal it. At least I think so.</p>

<p>With this kind of session management, the session couldn't possibly be stolen.
Suppose that the non-trusted site makes an XmlHttpRequest to gmail.com. If
cross-domain wasn't forbidden, any web-site could read your mails.</p>

<p>With the new session management, if the untrusted site makes a request to
gmail.com, gmail.com session wouldn't be available and the login page would be
returned instead of the list of e-mails. If the non trusted website tries to
log-in, you would be prompted to associate the Gmail session with the site you
don't trust. If you aren't completely idion, you wouldn't allow the online
pharmacy to connect to Gmail.</p>

<h3>Extra</h3>

<p><strong>What is known about you?</strong> Let's take an average person that uses her credit
card, have and Android phone with Gmail, uses Facebook:</p>

<ul>
<li>All your relationships are known by Google (Gmail, Google+) and Facebook</li>
<li>All your interests are known by Google and Facebook (Ad Sense track which
website you visit and Facebook have a huge profile on you)</li>
<li>All your posessions are known to your bank</li>
<li>Your photograph is known by Google and Facebook (people probably took a
photo of you and placed it on their Android phone synchronized with Google)</li>
<li>Your location is known (using your Android phone, your credit card, or your
RFID card you use for public transportation)</li>
<li>...</li>
</ul>


<p>If you ever want to keep private, it is becoming very difficult.</p>
</div></div>
          <div class='clear'></div>
        </div>
        <div class='sub-article'>
          <h2>
            <a class='permalink' href='../../../Blog/2011/10/19/blueprints_for_a_privacy_respecting_browser/'>Blueprints for a Privacy Respecting Browser</a>
          </h2>
          <div><p class='meta'>
  <span class='date-time'>
    <span class='date'>Wed 19 Oct 2011,</span>
    <span class='time'>10:21 AM</span>
  </span>
  <span class='author'>
    by
    <span class='author-name'>
      Mildred Ki'Lya
    </span>
  </span>
  <span class='tags'>
    <span class='tag'>
      <a class='tag' href='../../comp/'>comp</a>
    </span>
    <span class='tag'>
      <a class='tag' href='../../dev/'>dev</a>
    </span>
    <span class='tag'>
      <a class='tag' href='../../en/'>en</a>
    </span>
    <span class='tag'>
      <a class='tag' href='../../privacy/'>privacy</a>
    </span>
    <span class='tag'>
      <a class='tag' href='../'>web</a>
    </span>
  </span>
</p>
<div class='excerpt'>
  <p>What is this all about: web privacy. We are tracked everywhere, and i'd like to
help if possible. So, let's design a web browser that for once respects your
privacy.</p>

<p>Main features:</p>

<ul>
<li>Each website has its own cookie jar, its own cache and its own HTML5 local
storage</li>
<li>History related css attributes are disabled</li>
<li>External plugins are only enabled on demand</li>
<li>Support for Tor/I2P is enabled by default</li>
<li>You have complete control over who receives what information</li>
<li>Let's you control in the settings if you want to allow referrers or not.</li>
<li>The contextual menu let's you open links anonymously (no referrer, anonymous
session)</li>
</ul>


<p>The browser is bundled with a particular UI that let you control everything
during your browsing session. it is non intrusive and makes the best choice by
default. I am thinking of a notification bar that shows at the bottom. I noticed
that this place is not intrusive when I realized that the search bar in Firefox
was most of the time open, even if most of the time I didn't use it.</p>

<p>First, let's define a session:</p>

<ul>
<li>A session can be used my more than one domain at the same time.</li>
<li>A session is associated to a specific cache storage</li>
<li>A session is associated to a specific HTML5 storage</li>
<li>A session is associated to a specific cookie jar</li>
<li>A session acn be closed. When it is closed, session cookies are deleted from
the session</li>
<li>A session can be reopened. All long lasting cookies, cache, HTML5 storage
and such is then used again.</li>
<li>A session can be anonymous. In such a case, the session is deleted
completely when it is closed.</li>
<li>A session is associated to none, one or more domains. These domains are the
domains the end user can see in the address bar, not the sub items in the
page.</li>
</ul>


<p>Sessions are like Firefox profiles. If you iopen a new session, it's like you
opened a new Firefox profile you just created. Because people will never create
a different Firefox profile for each site.</p>

<p>If we want to protect privacy, when a link is opened, a new session should be
created each time. To make it usable to browse web sites, it is made possible to
share sessions in specific cases. Let's define the cases where it might be
intelligent to share a profile:</p>

<ul>
<li><p>You click a link or submit a form and expect to still be logged-in in the
site you are viewing. You don't care if you follow a link to an external
page.</p>

<p>User Interface: If the link matches one of the domains of the session, then
keep the session. No UI. If the user wanted a new session, the "Open
anonymously" entry in the context menu exists. A button on the toolbar might
be available to enter a state where we always want to open links
anonymously.</p>

<p>If the link points to another domain, then open the link in a new session
unless "Open in the same session" was specified in the context menu. The UI
contains:</p>

<pre><code>We Protected your privacy by separating &lt;domain of the new site&gt; from&#x000A;the site you were visiting previously (&lt;domain of the previous site&gt;).&#x000A;&#x000A;Choices: [ (1) Create a new anonymous session          | â–¼ ]&#x000A;         | (2) Continue session from &lt;previous domain&gt; |&#x000A;         | (3) Use a previous session for &lt;new domain&gt; |&#x000A;         | (4) Use session from bookmark "&lt;name&gt;"      |&#x000A;</code></pre>

<p>The first choice is considered the default and the page is loaded with it.
If the user chooses a new option, then the page is reloaded.</p>

<p>If the user chooses (2), the page is reloaded with the previous session and
the user will be asked if "Do you want &lt;old domain&gt; and &lt;new domain&gt; to have
access to the same private information about you?". Answers are Yes, No and
Always. If the answer is Always, then in the configuration, the two domains
are considered one and the same.</p>

<p>The choice (3) will use the most recent session for the new domain. It might
be a session currently in use or a session in the history.</p>

<p>There are as many (4) options as there are bookmarks for the new domain. If
different bookmarks share a single session, only one bookmark is shown. This
choice will load the session from the bookmark.</p>

<p>If (3) and (4) are the same sessions, and there is only one bookmark (4),
then the (4) option is left out.</p></li>
<li><p>You use a bookmark and expect to continue the session you had for this
bookmark (webmails)</p>

<p>The session is simpely stored in the bookmark. When saving a bookmark, there
is an option to store the session with it or not.</p>

<pre><code>[X] Do not save any personal information with this bookmark&#x000A;</code></pre></li>
<li><p>You open a new URL and you might want reuse a session that was opened for
this URL.</p>

<p>The User Interface allows you to restore the session:</p>

<pre><code>We protected your privacy by not sending any personal information to&#x000A;&lt;domain&gt;. If you want &lt;domain&gt; to receive private information, please&#x000A;select:&#x000A;&#x000A;Choices: [ Do not send private information     | â–¼ ]&#x000A;         | Use a previous session for &lt;domain&gt; |&#x000A;         | Use session from bookmark "&lt;name&gt;"  |&#x000A;</code></pre></li>
</ul>


<p>If you can see other use cases, please comment on that.</p>

<p>From these use cases, I can infer three kind of sessions:</p>

<ul>
<li>Live sessions, currently in use</li>
<li>Saved sessions, associated to a bookmark</li>
<li>Closed sessions in the past, accessible using history. Collected after a too
long time.</li>
</ul>


<p>Now, how to implement that? I was thinking of QtWebKit as I already worked with
Qt and it's easy to work with.</p>

<ul>
<li>We have a main widget: <code>QWebView</code>. We want to change the session when a new
page is loaded. So we hook up with the signal <code>loadStarted</code>.</li>
<li>We prevent history related CSS rules by implementing <code>QWebHistoryInterface</code>,
more specifically, we store the history necessary to implement
<code>QWebHistoryInterface</code> in the session.</li>
<li>We change the cache by implementing <code>QAbstractNetworkCache</code> and setting it
using <code>view-&gt;page()-&gt;networkAccessManager()-&gt;setCache(...)</code></li>
<li>We change the cookie jar by implementing <code>QNetworkCookieJar</code> and setting it
using <code>view-&gt;page()-&gt;networkAccessManager()-&gt;setCookieJar(...)</code></li>
<li>Change the local storage path using a directory dedicated for the session
and using <code>view-&gt;page()-&gt;settings()-&gt;setLocalStoragePath(QString)</code></li>
</ul>


<p>After all that, we'll have to inspect the resulting browser to determine if
there are still areas where we fail at protecting privacy.</p>
</div></div>
          <div class='clear'></div>
        </div>
        <div class='sub-article'>
          <h2>
            <a class='permalink' href='../../../Blog/2012/02/28/migration_to_webgen/'>Migration to Webgen</a>
          </h2>
          <div>
                <p class='meta'>
                  <span class='date-time'>
                    <span class='date'>Tue 28 Feb 2012,</span>
                    <span class='time'>11:07 AM</span>
                  </span>
                  <span class='author'>
                    by
                    <span class='author-name'>
                      Mildred Ki'Lya
                    </span>
                  </span>
                  <span class='tags'>
                    <span class='tag'>
                      <a class='tag' href='../../comp/'>comp</a>
                    </span>
                    <span class='tag'>
                      <a class='tag' href='../../en/'>en</a>
                    </span>
                    <span class='tag'>
                      <a class='tag' href='../'>web</a>
                    </span>
                  </span>
                </p>
                <div class='excerpt'>
                  <p>I just moved the site to <a href="https://github.com/mildred/webgen">webgen</a>. For the
                  occasion, forked the project on github and improved a lot of things. As webgen
                  doesn't seem to be alive, I think I'll be the one maintaining it in the future.</p>
                  
                  <p>I took the occasion to move my website over to my own web server, hosted at
                  home. If I ever find it unsuitable, I can very easily host my website elsewhere
                  as it is just a bunch of static pages.</p>
                  
                  <p>More to come ...</p>
                  <p>
                    <a href='../../../Blog/2012/02/28/migration_to_webgen/'>Continue Reading ...</a>
                  </p>
                </div>
              </div>
          <div class='clear'></div>
        </div>
        <div class='sub-article'>
          <h2>
            <a class='permalink' href='../../../Blog/2012/07/26/wwwgen_static_page_generator_and_beyond/'>WWWGen : Static Page Generator and Beyond</a>
          </h2>
          <div><p class='meta'>
  <span class='date-time'>
    <span class='date'>Thu 26 Jul 2012,</span>
    <span class='time'>10:57 AM</span>
  </span>
  <span class='author'>
    by
    <span class='author-name'>
      Mildred Ki'Lya
    </span>
  </span>
  <span class='tags'>
    <span class='tag'>
      <a class='tag' href='../../en/'>en</a>
    </span>
    <span class='tag'>
      <a class='tag' href='../../idea/'>idea</a>
    </span>
    <span class='tag'>
      <a class='tag' href='../'>web</a>
    </span>
    <span class='tag'>
      <a class='tag' href='../../wwwgen/'>wwwgen</a>
    </span>
    <span class='tag'>
      <a class='tag' href='../../wwwsupport/'>wwwsupport</a>
    </span>
  </span>
</p>
<div class='excerpt'>
  <p>I want to create a new static webpage generator. There are tons of them,
you'll tell me, why do I want to create a new one?</p>

<h2>Static Website Generator</h2>

<p>Let's see what we have:</p>

<ul>
<li>webby: my first love</li>
<li>nanoc: the second one I used</li>
<li>webgen: the one I'm using currently (with tons of local modifications)</li>
<li>jekyll: powering GitHub pages</li>
<li>and many more most probably</li>
</ul>


<p>Most of these systems take the assumption that you are a developer and
you are comfortable to write code to have your website running. In all
of these systems, I was forced to code some Ruby here and there to get
it working how I wanted to.</p>

<p>The case of nanoc3 is very special because the main configuration uses a
special Ruby DSL to manage the path locations. If you have non technical
users, they won't be willing to write code in this file anyway. And for
technical users, it might not be powerful enough.</p>

<p>Jekyll is probably the simplest system and can probably be used by non
technical users, but it is far too simple and not powerful enough.
That's why I didn't used it.</p>

<p>In the end, I modified Webgen a lot to include the following features:</p>

<ul>
<li>ability to write ruby code in haml instead on having to rely on the
template engine included in webgen</li>
<li>special .index nodes that will generate a paginated index of articles
found dynamically. The index would contain the last articles in reverse
order while the pages will contain each N articles in the natural order.
This way, an article that end up on page 3 is always going to be on page 3.</li>
<li>special .tags nodes that will generate .index pages dynamically to
create an index or articles for each tag.</li>
</ul>


<p>If you look around, there are not many static web page generators that
permit that. First, I decided I would maintain my own version of webgen
with these modifications, but now, I have the idea that the code base is
so horrible that I prefer rewrite the same functions from scratch.</p>

<h2>Rewriting From Scratch</h2>

<p>As I said, I'm not satisfied with the current status of the webgen code.
There is a complex system of cache, and a blackboard object that is used
to dispatch method call to the correct objects around the system. The
problem is that this extra indirection level makes it difficult to know
the code path. It would be useful if the hooks in the blackboard would
be highly dynamic, but it's mostly static. it serves no purpose whatsoever.</p>

<p>Moreover, I don't like big programs that do everything. And all of these
static website generators have a component that is used to determine
which pages are out of date, and only update them. This is traditionally
what make(1) should do. And recently, I found that
<a href="https://github.com/apenwarr/redo/">redo</a> does the job very well. So, I want it to be an integral
part of my new system.</p>

<h2>WWWSupport</h2>

<p>Recently, I wrote a piece of code: <a href="http://git.mildred.fr/?p=pub/mildred/wwwsupport.git;a=tree">WWWSupport</a>. It's a very
simple git repository that is supposed to be included as a submodule of
the git repository of a website. it contains a
<a href="http://cr.yp.to/daemontools.html">daemontools</a> daemon that receives e-mail from a special
mailbox and convert them into blog posts on the fly (that's how I'm
currently writing this block post).</p>

<p>I want my WWWGen project to integrate the same way into my website.</p>

<h2>WWWGen</h2>

<p>WWWGen is the name of my website generator. The architecture is very simple:</p>

<ul>
<li>A <code>src</code> directory containing the pages, in the same format as webgen</li>
<li>A <code>nodes</code> directory containing the files WWWGen is working on to
generate output</li>
<li>An output directory where the result files in <code>nodes</code> is copied to,
and where some static assets are copied as well (using rsync)</li>
<li>A redo script <code>all.do</code> that contains the configuration and invokes the
wwwgen script.</li>
</ul>


<p>The wwwgen script will create the <code>nodes</code> directory and the redo scripts
necessary to its working in it. Then, it will do three things:</p>

<ol>
<li><p>For each source file, the script will create:</p>

<ul>
<li>A .node file that contain a relative path to the source file, and
represents it.</li>
<li>As many .outdep files as the source file will generate output
files. The .outdep file is not managed by redo (because redo doesn't
support multiple targets yet). It references the .node file using a
relative path.</li>
</ul>


<p>  Note that during this process, new sources can be generated to allow
to create new nodes. This step will be executed until no new sources are
generated.</p></li>
<li><p>Once this is done, the main script will look for all of the .outdep
files and will build the corresponding .out file. The .out file will
contain the final processed result of the page</p></li>
<li><p>Copy all .out files in the output directory (after removing the .out
extension) and all the static files in the static directory.</p></li>
</ol>


<p>Note that step 1 and 2 recursively call redo to generate the .node and
.out files. This two step design is necessary to account for multiple
pages generated from a single source.</p>

<h2>Beyond</h2>

<p>In all my projects, I always want to focus on the usability of what I
create. I always think that non programmers should be able to do the
same that I did, to a certain limit. For example, my personal e-mail
server at home is scripted all the way. Reinstalling it should be a
matter of:</p>

<ul>
<li>installing a debian system with a basic configuration</li>
<li>clone my git repositories</li>
<li>Set some basic configuration (hostname, ...)</li>
<li>run <code>redo install</code></li>
</ul>


<p>I agree that even then, not anybody can install at home a mail server,
but with a process that simple, it's possible to create user interfaces
for it. So even if it's not there, it's a possibility.</p>

<p>I want the same for WWWGen. It leaves a possibility for creating a user
interface. Nothing prevents from creating a web application or even a
native application, that will create markdown pages with a WYSIWYG
editor (à la WordPress). The page files thus created could be checked
out in a git repository and pushed to a server. There, a hook will run
WWWGen to update the website with the modifications.</p>

<p>This could be seriously a very good alternative to WordPress, and I'd
preefer working with such a system than WordPress.</p>

<h2>What already exists</h2>

<p>I am not very good at creating desktop applications. So I thought I
would reuse the existing ones : my mailer. I's like a Content Management
System where everything must be configured by hand, and only articles
can be submitted using an e-mail.</p>

<p>This post is being sent by e-mail to my personal web server. Currently,
I'm still using plain text with a markdown syntax, but we could reuse
the HTML markup in a mail. This e-mail is then processed by a special
alias in <code>/etc/aliases</code>:</p>

<pre><code> http.www: "|/srv/http/www/wwwsupport/push.sh"&#x000A;</code></pre>

<p>This line was automatically generated by an install.do script. The
push.sh script will read the mail using a ruby script and will create a
file in my website git repository with the content of the mail. Then
webgen is run and the content of the repository is pushed to origin.</p>

<p>As a consequence, the new article appears on the website. This is a very
simple form of user interface, but it permits anybody to write blog posts.</p>

<h2>What features I would like to see</h2>

<ul>
<li>Better parsing of HTML e-mail</li>
<li>Using wwwgen instead of webgen</li>
<li>Support for image galleries using git-annex in wwwgen</li>
<li>Support for taking the attached images in an e-mail to create a
gallery on my website?</li>
</ul>


<h2>What features a customer would want</h2>

<p>A web application that can :</p>

<ul>
<li>modify the website configuration in the <code>all.do</code> file</li>
<li>modify any source files, using a WYSIWYG editor when applicable</li>
<li>add static assets (possibly using git-annex)</li>
<li>run the website compilation and preview it</li>
<li>push to a server to update the production website</li>
</ul>


<p>This is entirely possible.</p>
</div></div>
          <div class='clear'></div>
        </div>
        <div class='sub-article'>
          <h2>
            <a class='permalink' href='../../../Blog/2012/07/26/a_new_architecture_for_the_web/'>A New Architecture for the Web</a>
          </h2>
          <div><p class='meta'>
  <span class='date-time'>
    <span class='date'>Thu 26 Jul 2012,</span>
    <span class='time'>12:37 PM</span>
  </span>
  <span class='author'>
    by
    <span class='author-name'>
      Mildred Ki'Lya
    </span>
  </span>
  <span class='tags'>
    <span class='tag'>
      <a class='tag' href='../../en/'>en</a>
    </span>
    <span class='tag'>
      <a class='tag' href='../../idea/'>idea</a>
    </span>
    <span class='tag'>
      <a class='tag' href='../'>web</a>
    </span>
  </span>
</p>
<div class='excerpt'>
  <p>I want a new architecture for the web. But what web ?</p>

<h2>The Traditional Web</h2>

<p>A Web Site is a collection of Web Pages. A Web Page is a document, a
static document I might add. The document contains text, images, sound
and videos to present some information to the public. This is the
traditional version of the web that I respect very much.</p>

<p>There is no need to change this as it works very well. The web was
designed to allow a collection of documents to be accessed and does the
job very well</p>

<p>The one this that is sensible to do however is not to use any scripting
language to render the content of the pages. By definitions, these pages
are static, using a scripting language like PHP is not only going to be
inefficient, but is going to be a security risk.</p>

<h2>Web Applications</h2>

<p>This is an entire different thing, and the way we do this is completely
wrong. We think that a web application is a collection of dynamic web
pages. This should be erased from your mind.</p>

<p><strong>A Web Application is an application of its own right.</strong></p>

<p>Most unfortunately, applications are written in HTML which is not suited
for this purpose. The widgets are very few and the framework is not
suited to create complex User Interfaces.</p>

<h3>The very bad thing to do</h3>

<p><strong>You should not do this.</strong> Unfortunately, this is how it works for most.</p>

<p>A very bad programmer is going to create a web page for each of the
different aspects of its program. The web page would be dynamically
generated on the server using a template engine. Some JavaScript would
be included in this mess to avoid refreshing a page while in fact you
should.</p>

<p>This is bad because you'll have a ton of page refresh, and that's bad
for the user. If you're not using JavaScript, this is the old way of web
applications and is acceptable, but if you're using JavaScript for more
than a few things, it's bad.</p>

<p>You shouldn't use JavaScript to change the content of a page to match
what the server would generate just to avoid a refresh. Just because
this is just a way to recreate a template engine on the client that is
redundant with the one on the server.</p>

<p>And if you are using JavaScript to change the content of a page to get
the content that you should generally see in another page, you're a
moron. This breaks the back/forward mechanism and is very bad.</p>

<p>The only sensible thing to do  in this configuration with JavaScript is
to script the user interface. Show hidden sections, enable a button.
Don't contact the server using AJAX, you are already getting information
from the server using normal page reload.</p>

<h3>The sensible thing to do</h3>

<p><strong>Please do this!!!</strong></p>

<p>An application is an application. It's a bundle and can't be separated
into pages. It can be separated into sub-sections if you want, but those
will necessarily trigger a page refresh.</p>

<p>The application should be the equal of a desktop application using a
native toolkit, except that web technologies are used instead.
Contacting the server should be limited to what is necessary only
(fetching resources, exchange data, ...). In particular, the templates
should be on the client side.</p>

<p>On the server side, you'd have just a classic Web API, and static
resources. The Web API should be designed with care and security in
mind. It should be easily shared with third parties that want to
integrate within your application.</p>

<p>It is as simple as that:</p>

<ul>
<li>Server = Web API + Resources</li>
<li>Client = UI (incl templates)</li>
</ul>


<p>I heard that SproutCore is a solution to work this way, but it was
horrible to use it as well.</p>

<p>Perhaps, we need to get away from frameworks, there are many solutions
that can integrate well together and that don't need a framework. Read
this article for example: <a href="http://blog.getify.com/grab-ui-by-the-handlebar/">Grab UI by the Handlebar</a></p>

<h2>An Example</h2>

<p>I have a very simple example to show you what I mean, the comment
mechanism on this website. Each page contain a JavaScript script (just
look at the sources) that will add the comment features. The page
delivered by the server contain no information about the comments,
except a <code>&lt;noscript&gt;</code> tag to tell the people without JavaScript that
they miss the comments.</p>

<p>The script does an AJAX query on a third party server (with PHP and a
database). The arguments are the URL of the page and the answer is the
JSON formatted list of comments for the page. These comments are then
presented on the page. (The refresh link does this again)</p>

<p>The script also creates a form to add a comment. When the form is
submitted, an AJAX query is made with the URL of the page and the
content of the comment as arguments.</p>

<p>This is how all web applications should work.</p>

<h2>Going further: static databases on the server</h2>

<p>I already wrote an article on this, but I'll summarize the idea here.</p>

<p>With this new idea for web applications, the application logic is moved
from the server to the client. Perhaps not all the way, but for simple
applications like the comments above, the server API is nothing much
than a fancy database API.</p>

<p>Why not model a database on this model? But it already exists:
<a href="https://en.wikipedia.org/wiki/CouchDB">CouchDB</a>. This is a database which API is a web API. I want to
take the principles of this database and mix them with the ideas of a
static page generator.</p>

<p>The idea is that read only access when the resource URL is known, a
static page should correspond to the URL and a classic web server should
answer the query.</p>

<p>Only update and search queries would be filtered by the web server to a
FastCGI application that is going to update the static files, or look at
them to answer the search.</p>

<p>I find it difficult to find advantages of this compared to CouchDB.
There is one thing, your data will always be accessible read only. No
obscure database format that require a database server that might not
work on new hardware, might not be maintained any more...</p>

<h2>Conclusion</h2>

<p>With this approach, most web applications could be composed of static
assets that are accessing a database with a Web API. The static assets
and the database could be on the same server or on a different one. No
limit is posed here, except the same origin restriction of web browsers.</p>

<p>Fortunately, a new standard (that I'm using for the comments of this
website) let you specify if the same origin policy should apply or not:
<a href="http://www.w3.org/TR/access-control/">Cross-Origin Resource Sharing</a></p>

<h2>What about Cookies Then?</h2>

<p><strong>They should not exist in their current form.</strong></p>

<p>This was a late addition to the HTTP standard, because it was already
implemented. It was never really thought of, and is a breach of the
original HTTP model.</p>

<p><strong>The cookies are what allows XSS vulnerabilities, NOT JavaScript</strong></p>

<p>The current web community takes the things the wrong way. Instead of
damning cookies forever, they blame on JavaScript and try to build walls
all over the place to avoid XSS while there is a most simple solution.</p>

<h3>What are XSS?</h3>

<blockquote><p>Cross-site scripting (XSS) is a type of computer security vulnerability typically found in Web applications, such as web browsers through breaches of browser security, that enables attackers to inject client-side script into Web pages viewed by other users. A cross-site scripting vulnerability may be used by attackers to bypass access controls such as the same origin policy. Cross-site scripting carried out on websites accounted for roughly 84% of all security vulnerabilities documented by Symantec as of 2007.[1] Their effect may range from a petty nuisance to a significant security risk, depending on the sensitivity of the data handled by the vulnerable site and the nature of any security mitigation implemented by the site's owner.</p></blockquote>

<p>(Source: <a href="https://en.wikipedia.org/wiki/Cross-site_scripting">Wikipedia</a>)</p>

<p>This is a wrong way to look at the problem. Inclusion of other items in
web pages dates from the very beginning. It is the foundation of the
web. What allows to have rich documents, with links between them. The
same origin policy is just one of these walls that I talked about, that
assumes that all pages on the current domain can be trusted. Is that true?</p>

<p>The real story is that if the design of the web was correct, the script
injected by attackers in web pages would be completely harmless. The
same origin policy shouldn't exist and bypassing it should be by no mean
be a security risk.</p>

<p>We have come to a situation where WebGL can be a security risk because
it can determine the colours of an image included in the web page. Just
because an image can, from the very beginning of the web, bypass the
same origin policy. Some people say that images should respect the same
origin policy, but what they don't imagine is that we could just forget
all of this mess.</p>

<h3>The Real Problem.</h3>

<p>The <em>real</em> problem is that when loading foreign content, though AJAX,
the use of images or whatever, a page can load a foreign page where you
are logged in using cookies. And access your foreign account. For
example your bank account.</p>

<p>The problem is that the page containing the XSS script was granted the
access to the cookie protecting your bank account.</p>

<p><strong><em>Why the hell your bank account is just protected by a cookie than any
page can have access to???</em></strong></p>

<h3>The solution</h3>

<p>Unless you have in your address bar the address of your bank, the cookie
protecting your bank account should be locked away. In fact, instead of
having everything in a page respect the same origin policy, <strong>cookies
should be the single thing respecting the same origin policy;</strong></p>

<p>This is just a change in the handling of the cookie by the browser. Not
a very big change at that. Only cookies for the domain in the address
bar should be exploitable. But it would break a number of assumption:</p>

<p>Third party cookies would no longer exist, this would be a big shock for
advertisers and tracking programs. A loss for these companies, but a win
for personal privacy.</p>

<h4>Allow third party cookies nonetheless</h4>

<p>We could nonetheless allow third party cookies, but only in the context
of a specific page:</p>

<ul>
<li>each tab/window of the browser share the same cookie jar for the requests</li>
<li>for each tab/window, a separate cookie jar would be assigned that will
be emptied when a link is followed to a different origin</li>
<li>the sub-elements of a page that are not of the same origin of the page
itself, should have their cookies in the sub cookie jar only</li>
<li>if there are sub-sub elements, they should be assigned to a sub-sub
cookie jar recursively.</li>
</ul>


<h4>Allow third party cookies to access the main cookie jar on demand</h4>

<p>This would nonetheless break a number of things. Third party scripts
expect to see the same cookies they set a while ago, even if it was not
on the same page.</p>

<p>A solution to this problem would be to add an option in the browser UI
to specifically allow a third party script in a page to access the
global cookie jar. There would be a button saying for example "Some
cookies have been blocked". When clicked it would open a menu with:</p>

<ul>
<li>Allow access to ad.doubleclick.com</li>
<li>Allow access to facebook.com</li>
<li>Allow access to my-bank.com</li>
</ul>


<p>A sensible person would not allow a blog with an XSS script access his
bank website, but would allow facebook if he wants to use a facebook button.</p>

<h4>Browser plugins, anyone ?</h4>

<p>I'd love a browser plugin for that !</p>

<p>Unfortunately, on Firefox, creating sub cookie jar would be difficult
due to the architecture of it. Webkit is better on that.</p>

<h3>Conclusion</h3>

<p>Cookies aren't necessarily bad, they should just respect the same origin
policy they introduced instead of imposing it to all of the other
elements of a page. This can already be done now in web browsers, it
just needs a consensus. Or at least, an extension with the right UI to
bypass the same origin on demand when the scripts needs to.</p>
</div></div>
          <div class='clear'></div>
        </div>
      </div>
      <div class='page-list'>
        <strong>Page:</strong>
        <ul class='page-list'>
          <li>
            <strong>1</strong>
          </li>
          <li>
            <a href='../'>latest</a>
          </li>
        </ul>
      </div>
      <div class='clear'></div>
    </div>
    <div class='clear'></div>
    <div class='footer'>
      <hr />
      <p>E-mail:
        <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#37;&#54;&#68;&#37;&#54;&#57;&#37;&#54;&#67;&#37;&#54;&#52;&#37;&#55;&#50;&#37;&#54;&#53;&#37;&#54;&#52;&#37;&#50;&#68;&#37;&#55;&#48;&#37;&#55;&#53;&#37;&#54;&#50;&#37;&#50;&#68;&#37;&#51;&#49;&#37;&#52;&#48;&#37;&#54;&#68;&#37;&#54;&#57;&#37;&#54;&#67;&#37;&#54;&#52;&#37;&#55;&#50;&#37;&#54;&#53;&#37;&#54;&#52;&#37;&#50;&#69;&#37;&#54;&#54;&#37;&#55;&#50;">&#109;&#105;&#108;&#100;&#114;&#101;&#100;&#45;&#112;&#117;&#98;&#45;&#49;&#64;&#109;&#105;&#108;&#100;&#114;&#101;&#100;&#46;&#102;&#114;</a>
      </p>
      <p>Mildred's Website: <a href="http://mildred.fr">http://mildred.fr</a>.
      I try to have <a href="http://www.w3.org/Provider/Style/URI">cools URI that don't change</a>.</p>
    </div>
  </body>
</html>
