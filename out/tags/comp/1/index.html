<!DOCTYPE html>
<html>
  <head>
    <title>Category: comp - Mildred's Website</title>
    <meta charset='utf-8'>
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta content='' name='keywords'>
    <meta content='' name='description'>
    <meta content='initial-scale=1.0, width=device-width' name='viewport'>
    <meta content='tag' name='x-kind'>
    <link href='http://mildred.fr/tags/comp/1/' rel='canonical'>
    <link href='../../../favicon.png' rel='icon' type='image/png'>
    <link href='../../../favicon.png' rel='shortcut icon' type='image/png'>
    <link href='../../../style.css' media='screen' rel='stylesheet' type='text/css'>
    <link href='../atom.xml' rel='alternate' title='ATOM Feed' type='application/atom+xml'>
    <link href='../rss.xml' rel='alternate' title='RSS Feed' type='application/rss+xml'>
    <script src='../../../Scripts/json/json2.js' type='text/javascript'></script>
    <script src='../../../Scripts/jquery.min.js' type='text/javascript'></script>
    <script src='../../../Scripts/comments.js' type='text/javascript'></script>
    <script src='../../../Scripts/local.js' type='text/javascript'></script>
  </head>
  <body>
    <div class='header'>
      <p class='access-links'>
        <a href='#menu'>Go to Menu</a>
        <br>
        <a href='#content'>Go to Content</a>
      </p>
      <div class='left'>
        <a href='../../../'>
          <img alt='My photo' class='photo' src='../../../Images/IMG_5669_square_128.jpeg'>
        </a>
      </div>
      <div class='title'>
        <h1>
          <a href='../../../'>Mildred's Website</a>
        </h1>
      </div>
      <div class='float-right'></div>
      <div class='clear-right'></div>
      <div class='right'>
        <strong>Tags:</strong>
        <ul class='tags'>
          <li>
            <a class='tag' href='../../cobra/'>cobra</a>
          </li>
          <li>
            <a class='tag' href='../'>comp</a>
          </li>
          <li>
            <a class='tag' href='../../configuration/'>configuration</a>
          </li>
          <li>
            <a class='tag' href='../../dev/'>dev</a>
          </li>
          <li>
            <a class='tag' href='../../dream/'>dream</a>
          </li>
          <li>
            <a class='tag' href='../../en/'>en</a>
          </li>
          <li>
            <a class='tag' href='../../fedora/'>fedora</a>
          </li>
          <li>
            <a class='tag' href='../../fr/'>fr</a>
          </li>
          <li>
            <a class='tag' href='../../freedombox/'>freedombox</a>
          </li>
          <li>
            <a class='tag' href='../../git/'>git</a>
          </li>
          <li>
            <a class='tag' href='../../html/'>html</a>
          </li>
          <li>
            <a class='tag' href='../../idea/'>idea</a>
          </li>
          <li>
            <a class='tag' href='../../liens/'>liens</a>
          </li>
          <li>
            <a class='tag' href='../../lisaac/'>lisaac</a>
          </li>
          <li>
            <a class='tag' href='../../lysaac/'>lysaac</a>
          </li>
          <li>
            <a class='tag' href='../../misc/'>misc</a>
          </li>
          <li>
            <a class='tag' href='../../photos/'>photos</a>
          </li>
          <li>
            <a class='tag' href='../../physics/'>physics</a>
          </li>
          <li>
            <a class='tag' href='../../politique/'>politique</a>
          </li>
          <li>
            <a class='tag' href='../../privacy/'>privacy</a>
          </li>
          <li>
            <a class='tag' href='../../srs/'>srs</a>
          </li>
          <li>
            <a class='tag' href='../../test/'>test</a>
          </li>
          <li>
            <a class='tag' href='../../web/'>web</a>
          </li>
          <li>
            <a class='tag' href='../../website/'>website</a>
          </li>
          <li>
            <a class='tag' href='../../wwwgen/'>wwwgen</a>
          </li>
          <li>
            <a class='tag' href='../../wwwsupport/'>wwwsupport</a>
          </li>
        </ul>
      </div>
      <div class='content'>
        <div class='links' id='menu'>
          <ul>
            <li>
              <a href='../../../'>Home</a>
            </li>
            <li>
              <a href='../../../Blog/'>Blog</a>
            </li>
            <li>
              <a href='//survie.mildred.fr'>Survie</a>
            </li>
          </ul>
        </div>
      </div>
      <div class='clear'></div>
    </div>
    <div class='leftcol'>
      <img alt='My avatar' class='photo' src='../../../Images/all128.jpeg'>
      <hr>
      <p>GoogleTalk, Jabber, XMPP address:
      <br /><strong><a href="xmpp:mildred&#64;jabber.fr">mildred&#64;jabber.fr</a></strong><!--&nbsp;<img src="http://presence.jabberfr.org/2dc519ffec76a836c2f2c2f66ac38291/image-dcraven.png" alt="" /><br /><em><script type="text/javascript" src="http://presence.jabberfr.org/2dc519ffec76a836c2f2c2f66ac38291/message_js.js"></script></em>-->
      </p>
      <hr>
      <p>
        <a href='../../../gpg_key.txt'>GPG Public Key</a>
        <br>
        <span style='font-size: 0.8em'>
          (Fingerprint 197C A7E6 645B 4299 6D37 684B 6F9D A8D6 9A7D 2E2B)
        </span>
      </p>
    </div>
    <div class='main' id='content'>
      <h1>Category: comp</h1>
      <p>Articles from 1 to 10</p>
      <div class='article-list'>
        <div class='sub-article'>
          <h2>
            <a class='permalink' href='../../../Blog/2010/09/06/aliasing-strings-in-lisaac/'>Aliasing Strings in Lisaac</a>
          </h2>
          <div><p class='meta'>
  <span class='date-time'>
    <span class='date'>Mon 06 Sep 2010,</span>
    <span class='time'>09:13 AM</span>
  </span>
  <span class='tags'>
    <span class='tag'>
      <a class='tag' href='../'>comp</a>
    </span>
    <span class='tag'>
      <a class='tag' href='../../dev/'>dev</a>
    </span>
    <span class='tag'>
      <a class='tag' href='../../fr/'>fr</a>
    </span>
    <span class='tag'>
      <a class='tag' href='../../lisaac/'>lisaac</a>
    </span>
  </span>
</p>
<div class='excerpt'>
  <p>En Lisaac, il y a trois types de chaînes de caractères: <code>ABSTRACT_STRING</code> qui
sert de parent à <code>STRING</code> et <code>STRING_CONSTANT</code>.</p>

<ul>
<li><p>Le prototype <code>ABSTRACT_STRING</code> contient les méthodes de bases pour toutes
les chaînes de caractères, utile à leur manipulation. C'est une <em>classe
abstraite</em> qui sert à la manipulation en lecture seule de toute chaîne de
caractères.</p></li>
<li><p><code>STRING</code> est un prototype qui introduit des méthodes de modification, comme
l'ajout d'une autre chaîne en fin. Il est très pratique en tant que buffer
pour construire une chaîne.</p></li>
<li><p>Vous l'aurez deviné, les <code>STRING_CONSTANT</code> sont des chaînes constantes qu'on
ne peux pas modifier (non mutables). Ce n'est pas techniquement impossible,
il vaut cependant mieux éviter. Ces <code>STRING_CONSTANT</code> correspondent en fait
aux chaînes littérales incluses dans le segment DATA de l'exécutable généré.
Ainsi, toutes ces chaînes sont obligatoirement terminées par <code>'\0'</code>
contrairement aux autres chaînes.</p>

<p>Une autre particularité est que les chaînes <code>STRING_CONSTANT</code> sont générées
par le compilateur, qui va s'assurer qu'il n'y aura pas deux chaînes
différentes compilées dans le programme avec le même contenu.</p></li>
</ul>


<p>Quelle conclusion peut on en tirer quant à la comparaison entre chaînes ?</p>

<ol>
<li><p>Il est nécessaire de comparer les chaînes caractère à caractère pour
s'assurer de leur égalité</p></li>
<li><p>Dans le cas des <code>STRING_CONSTANT</code>, il est possible de ne faire qu'une
comparaison de pointeurs.</p></li>
</ol>


<p>Bien sûr, la méthode n°2 est beaucoup plus rapide, Si possible, on aimerait
pouvoir l'utiliser tout le temps. Dans le cas du compilateur Lisaac, les
performances étant tellement critiques (nous avons affaire à un algorithme
exponentiel) que Benoît s'est arrangé pour toujours faire une comparaison de
pointeurs. Comment ?</p>

<p>Tout simplement en transformant les chaînes classiques en <code>STRING_CONSTANT</code>.
Cela est fait en construisant de toute pièces l'objet <code>STRING_CONSTANT</code> en
copiant les données contenues dans n'importe quelle autre chaîne. Et pour
s'assurer de l'unicité de la chaîne, il est nécesaire au préalable de vérifier
que la chaîne <code>STRING_CONSTANT</code> n'existe pas déjà.</p>

<p>Pour cela, toutes les chaînes utiles dans le compilateur à tout instant se
trouvent dans un prototype <code>ALIAS_STR</code>. Pour les utiliser, on fait juste
référence au nom du slot dans <code>ALIAS_STR</code>. Ces chaînes sont de plus insérées
au démarrage du compilateur dans l'ensemble <code>SET(ABSTRACT_STRING)</code> qui contient
toutes les chaînes constantes.</p>

<p>Cela reste une manipulation lourde (il est nécessaire d'insérer à la main toutes
les chaînes constantes qu'on utilise quelque part dans le compilateur dans cet
ensemble de chaînes) réservée au compilateur Lisaac. La conversion entre
<code>ABSTRACT_STRING</code> et <code>STRING_CONSTANT</code> reste explicite et alourdit le code. J'ai
eu donc envie de généraliser cela en l'implémentant en bibliothèque.</p>

<p>Avec les systèmes d'auto-import et auto-export, la conversion peut être très
facile. Il restait cependant le problème délicat de référencer toutes les
<code>STRING_CONSTANT</code> du segment DATA et de les insérer dans l'ensemble des chaînes.
Pour cela il faut ajouter un système d'introspection qui permet au programme de
parcourir toutes les chaînes constantes compilées. J'ai pensé à plusieurs
solutions:</p>

<ul>
<li><p>Ajouter trois externals pour respectivement avoir la borne basse du tableau
des chaînes compilées, la borne haute, et un moyen d'obtenir la chaîne à un
indice donné. Cela s'est avéré trop compliqué dans la mesure où les
externals sont évalués lors du depending pass et que les chaînes constantes
ne sont connues que lors de l'executong pass (voire à la toute fin de
l'exécution du compilateur).</p>

<p>Il aurait donc fallu ajouter une instruction pour évaluer la borne haute et
basse, et évaluer la <em>n</em><sup>ième</sup> chaîne. Puisque le paramètre est
tout sauf une constante entière, cela voudrait dire construire un bloc
conditionnel <code>SWITCH</code>. Trop complexe.</p></li>
<li><p>Seconde solution, fournir ldans deux externals le nombre de chaînes et un
pointeur vers un <code>NATIVE_ARRAY(STRING_CONSTANT)</code>. C'était la solution la
plus prometteuse, mais cela aurait complexifié la génération de code.</p>

<p>En effet, <code>NATIVE_ARRAY(STRING_CONSTANT)</code> se traduit en type C par
<code>STRING_CONSTANT**</code>. J'ai pensé au début que construire le code C suivant
suffirait:</p>

<pre><code>STRING_CONSTANT* __string = {&#x000A;  {12, "123456789012"},&#x000A;  ...&#x000A;  NULL&#x000A;};&#x000A;</code></pre>

<p>Sauf que cette construction est invalide en C, nous avons affaire à un
tableau de <code>Expanded STRING_CONSTANT</code>, et le marqueur <code>NULL</code> ne compile donc
pas en C. J'aurais donc pu créer le tableau à part, mais je n'avais pas
envie.</p>

<p>Ce qui aurait été possible:</p>

<pre><code>__STRING_CONSTANT __string_1 = {12, "123456789012"};&#x000A;...&#x000A;&#x000A;__STRING_CONSTANT* __string[] = {&#x000A;  __string_1,&#x000A;  ...&#x000A;  NULL&#x000A;};&#x000A;</code></pre></li>
<li><p>Dernière solution, la liste chaînée. Chaque chaîne est liée par un pointeur
à la chaîne précédante, et un unique external est généré pour avoir le haut
de la liste. Au final, cela ne prend pas plus de place qu'un tableau et
permet plus de possibilités (comme par exemple de faire rentrer dans la
liste des chaînes construites après coup). Le code C généré ressemble à:</p>

<pre><code>__STRING_CONSTANT __string_1 = {STRING_CONSTANT__, 12, "123456789012"};&#x000A;__STRING_CONSTANT __string_2 = {&amp;__string_1,       12, "123456789013"};&#x000A;__STRING_CONSTANT __string_3 = {&amp;__string_2,       12, "123456789014"};&#x000A;__STRING_CONSTANT* __string_first = &amp;__string_3;&#x000A;</code></pre>

<p>La première chaîne est liée au prototype (qui est lié à <code>NULL</code>) et les
chaînes suivantes sont liées à celles d'avant. Un symbole spécial représente
le haut de la pile qui est très simplement disponnible avec un external.
C'est la solution que j'ai retenue.</p></li>
</ul>


<p>Une fois le compilateur modifié, il faut modifier la bibliothèque standard. Au
début, j'ai eu pour approche d'utiliser la liste chaînée comme ensemble de
chaînes uniques au lieu d'un <code>HASHED_SET</code>. Mais les performances ont été
tellement déplorables que j'en suis revenu à l'ensemble de hash.</p>

<p>Les modifications sont presque prêtes, et il va être nécessaire d'introduire
deux commits de bootstrap (un commit pour introduire la fonctionnalité dans le
compilateur, l'autre avec une bibliothèque standard modifiée et le compilateur
qui délègue l'aliasing à la bibliothèque).</p>

<p>Il reste quelques problèmes à corriger, et ce sera prêt.</p>

<p>Mildred.</p>
</div></div>
          <div class='clear'></div>
        </div>
        <div class='sub-article'>
          <h2>
            <a class='permalink' href='../../../Blog/2010/09/07/prototypes/'>Prototypes</a>
          </h2>
          <div><p class='meta'>
  <span class='date-time'>
    <span class='date'>Tue 07 Sep 2010,</span>
    <span class='time'>06:16 PM</span>
  </span>
  <span class='tags'>
    <span class='tag'>
      <a class='tag' href='../'>comp</a>
    </span>
    <span class='tag'>
      <a class='tag' href='../../en/'>en</a>
    </span>
  </span>
</p>
<div class='excerpt'>
  <p>What is a prototype? I often wondered what it exactly meant. And I am
developping a prototype-based language: Lisaac.</p>

<p>I went on Wikipedia to find out:</p>

<blockquote><p>Prototype-based programming is a style of object-oriented programming in which
classes are not present, and behavior reuse (known as inheritance in
class-based languages) is performed via a process of cloning existing objects
that serve as prototypes. This model can also be known as class-less,
prototype-oriented or instance-based programming. Delegation is the language
feature that supports prototype-based programming.</p></blockquote>

<p>To cut the story short:</p>

<ul>
<li>you don't have classes</li>
<li>instead you already have full featured objects (with values)</li>
<li>you don't instanciate, you clone the prototype</li>
</ul>


<p>And that's all. But often, prototype-based language have other very interesting
features.</p>
</div></div>
          <div class='clear'></div>
        </div>
        <div class='sub-article'>
          <h2>
            <a class='permalink' href='../../../Blog/2010/09/07/design-patterns/'>Design Patterns</a>
          </h2>
          <div>
                <p class='meta'>
                  <span class='date-time'>
                    <span class='date'>Tue 07 Sep 2010,</span>
                    <span class='time'>06:26 PM</span>
                  </span>
                  <span class='tags'>
                    <span class='tag'>
                      <a class='tag' href='../'>comp</a>
                    </span>
                    <span class='tag'>
                      <a class='tag' href='../../fr/'>fr</a>
                    </span>
                  </span>
                </p>
                <div class='excerpt'>
                  <p>Vous verrez peut être bientôt apparaître ici les différents design patterns
                  implémentés en différents langages, y figureront au moins Ada et Lisaac.</p>
                </div>
              </div>
          <div class='clear'></div>
        </div>
        <div class='sub-article'>
          <h2>
            <a class='permalink' href='../../../Blog/2010/09/15/problemes-de-performance/'>Problèmes de Performance</a>
          </h2>
          <div><p class='meta'>
  <span class='date-time'>
    <span class='date'>Wed 15 Sep 2010,</span>
    <span class='time'>02:08 PM</span>
  </span>
  <span class='tags'>
    <span class='tag'>
      <a class='tag' href='../'>comp</a>
    </span>
    <span class='tag'>
      <a class='tag' href='../../dev/'>dev</a>
    </span>
    <span class='tag'>
      <a class='tag' href='../../fr/'>fr</a>
    </span>
    <span class='tag'>
      <a class='tag' href='../../lisaac/'>lisaac</a>
    </span>
  </span>
</p>
<div class='excerpt'>
  <p>Ce post fait suite à mon <a href="/blog/2010/09/06/aliasing-strings-in-lisaac.html">précédent post sur l'aliasing des chaînes de
caractères</a>. Je disais que j'avais
presque fini, mais ce n'est sans doute pas le cas.</p>

<p>J'ai de gros problèmes de performance.</p>

<p>Rappelons ce que je cherche à faire :</p>

<ul>
<li>Ajouter une ou des primitives pour accéder aux <code>STRING_CONSTANT</code> compilées</li>
<li>Ajouter le support de l'aliasing des chaînes de caractères dans la
bibliothèque standard</li>
<li>Remplacer l'aliasing des chaînes du compilateur (<code>ALIAS_STR</code>) par l'aliasing
fait dans la bibliothèque standard.</li>
</ul>


<p>La première étape est réalisée grâce aux listes chaînées. Les primitives de
compilation ont été ajoutées.</p>

<p>La modification de la bibliothèque standard est bien avancée. Comme cela
nécessite une nouvelle primitive du compilateur, il à fallu bootstrapper le
compilateur à nouveau.</p>

<p>Et maintenant, vient la dernière étape: supprimer l'aliasing du compilateur.
Pour cela, je commence par me compiler un compilateur Lisaac avec <em>la nouvelle
primitive</em> et <em>son support dans la bibliothèque standard</em>. Ce compilateur est
<strong>extrêmement lent</strong> (2h45 de bootstrap). En effet, l'aliasing est réalisé en double. Puis je
supprime le support de l'aliasing du compilateur et j'ai un gros problème:</p>

<ul>
<li>le compilateur en mode optimisé plante</li>
<li>le compilateur en mode optimisé compilé avec gcc en mode debug ne plante pas</li>
<li>le compilateur en mode debug ne plante pas</li>
</ul>


<p>Je ne sais plus quoi faire ... et j'en suis là pour le moment. Je me demande si
c'est <code>-O2</code> ou <code>-fomit-frame-pointer</code> qui pose problème.</p>

<p><strong>Pour les problèmes d'optimisation,</strong> je pense savoir un peu ce qui cloche.
Voici comment j'ai implémenté l'aliasing dans <code>STRING_CONSTANT</code>:</p>

<pre><code>Section Public&#x000A;&#x000A;  - first_string :STRING_CONSTANT &lt;- (first_string := `100`);&#x000A;  // Il s'agit ici du pointeur de tête vers la liste chaînée au complet&#x000A;&#x000A;  + next_string :STRING_CONSTANT := NULL;&#x000A;  // Pointeur suivant de chaque STRING_CONSTANT vers la suivante (initialisé&#x000A;  // par le compilateur)&#x000A;&#x000A;Section Private&#x000A;&#x000A;  //&#x000A;  // Aliasing String.&#x000A;  //&#x000A;&#x000A;  - bucket:SET(ABSTRACT_STRING) &lt;-&#x000A;  // Ensemble de toutes les chaînes. HASHED_SET est tout de même bien plus&#x000A;  // performant qu'une liste chaînée non ordonnée.&#x000A;  ( + sc :STRING_CONSTANT;&#x000A;    bucket := HASHED_SET(ABSTRACT_STRING).create;&#x000A;&#x000A;    sc := first_string;&#x000A;    {(sc != STRING_CONSTANT) &amp;&amp; {sc != NULL}}.while_do {&#x000A;      bucket.fast_add sc;&#x000A;      sc := sc.next_string;&#x000A;    };&#x000A;&#x000A;    bucket&#x000A;  );&#x000A;&#x000A;  - list_insert &lt;-&#x000A;  // On met quand même à jour la liste chaînée, ça peut servir.&#x000A;  [&#x000A;    -? { first_string != Self };&#x000A;  ]&#x000A;  (&#x000A;    bucket.fast_add Self;&#x000A;    next_string  := first_string;&#x000A;    first_string := Self;&#x000A;  );&#x000A;&#x000A;Section Public&#x000A;&#x000A;  - new_intern p:NATIVE_ARRAY(CHARACTER) count nb_char:INTEGER :SELF&lt;-&#x000A;  // Do not use directly. WARNING: Use by c_string and c_argument (COMMAND_LINE).&#x000A;  ( + sc, result:STRING_CONSTANT;&#x000A;&#x000A;    sc := clone;&#x000A;    sc.set_storage p count nb_char;&#x000A;    result ?= bucket.reference_at sc;&#x000A;    (result = NULL).if {&#x000A;      result := sc;&#x000A;      result.list_insert;&#x000A;    };&#x000A;&#x000A;    result&#x000A;  );&#x000A;</code></pre>

<p>En fait, j'ai pas du tout assuré !!!</p>

<p>J'ai deux slots code (<code>&lt;-</code>) qui sont réinitialisés en données (<code>:=</code>). Cela veut
dire qu'à chaque fois que le slot est appelé, le compilateur va intéroger un
slot invisible auto-généré pour savoir si c'est la donnée qu'on veut ou le code.</p>

<p>En plus j'ai l'impression que la version de Lisaac que j'utilise pour compiler
(celle qui met 2h45) avait peut être une ancienne version de la lib ou
l'aliasing était fait par la liste chaînée non triée au lieu de <code>HASHED_SET</code>.
Bref, j'ai tout à revoir.</p>

<p>Mildred</p>
</div></div>
          <div class='clear'></div>
        </div>
        <div class='sub-article'>
          <h2>
            <a class='permalink' href='../../../Blog/2010/09/28/probleme-fedora-14/'>Mise à jour périlleuse avec Fedora 14</a>
          </h2>
          <div><p class='meta'>
  <span class='date-time'>
    <span class='date'>Tue 28 Sep 2010,</span>
    <span class='time'>02:03 PM</span>
  </span>
  <span class='tags'>
    <span class='tag'>
      <a class='tag' href='../'>comp</a>
    </span>
    <span class='tag'>
      <a class='tag' href='../../fedora/'>fedora</a>
    </span>
    <span class='tag'>
      <a class='tag' href='../../fr/'>fr</a>
    </span>
  </span>
</p>
<div class='excerpt'>
  <p>Tout commence à mon avis avec une simple mise à jour de mon installation
principale de Fedora: <code>sudo yum upgrade --skip-broken</code>. Tout semble bien se
passer et je continue à travailler.</p>

<pre><code>Sep 28 09:37:34 Updated: glibc-common-2.12.90-13.x86_64&#x000A;Sep 28 09:42:00 Updated: glibc-2.12.90-13.x86_64&#x000A;Sep 28 09:42:55 Updated: glibc-headers-2.12.90-13.x86_64&#x000A;Sep 28 09:51:07 Updated: selinux-policy-3.9.5-7.fc14.noarch&#x000A;Sep 28 09:53:27 Updated: nscd-2.12.90-13.x86_64&#x000A;Sep 28 09:55:02 Updated: gdb-7.2-15.fc14.x86_64&#x000A;Sep 28 09:58:00 Updated: planner-0.14.4-26.fc14.x86_64&#x000A;Sep 28 10:01:25 Updated: gnome-user-share-2.30.1-1.fc14.x86_64&#x000A;Sep 28 10:10:48 Updated: selinux-policy-targeted-3.9.5-7.fc14.noarch&#x000A;Sep 28 10:11:04 Updated: glibc-devel-2.12.90-13.x86_64&#x000A;Sep 28 10:11:16 Updated: rpmdevtools-7.10-1.fc14.noarch&#x000A;Sep 28 10:12:34 Updated: glibc-debuginfo-2.12.90-13.x86_64&#x000A;Sep 28 10:12:58 Updated: glibc-2.12.90-13.i686&#x000A;</code></pre>

<p>Soudain, plus rien ne marche. N'importe quelle commande me retourne un segfault,
j'essaie d'ouvrir un nouvel onglet dans mon émulateur de terminal, il se ferme
aussitôt. Je tente de me déconnecter pour me reconnecter, pensant que cela
résoudrait le problème, mais en me déconnectant, l'interface graphique tombe en
rade et sur la console, j'ai un message qui tourne en boucle concernant le
daemon abrt chargé d'enregistrer tous les crash pour en faire des rapports de
bugs. Je tente de redémarrer l'ordinateur, mais ça ne marche pas, alors je
l'arrête de force.</p>

<p>Je le redémarre, et ...</p>

<p>J'ai une erreur dans <code>/sbin/init</code>, un segfault qui à été localisé dans <code>ld.so</code>.
Je tente avec <code>init=/bin/sh</code> ou encore <code>selinux=0</code> sans résultat.</p>

<p>Je panique.</p>

<p>Comment faire ? Démarrer sur un système de secours bien sûr. Je resors une clef
USB que je pensait cassée, mais elle marche et j'arrive à booter sur une
Fedora 13 i686. Génial.</p>

<p>Je tente un <code>chroot /mnt/fedora /bin/init</code> ... bien sûr le format du binaire
n'est pas reconnu, c'est un binaire 64bits et le kernel de la clef USB est
32 bits uniquement.</p>

<p>Je tente un <code>yum --installroot=/mnt/fedora info glibc</code> et j'ai un problème de
versions de base de donnée qui ne correspond pas.</p>

<p>Conclusion, il me faut une clef USB avec Fedora 14 x86_64. Je commence à
télécharger l'image ISO et je passe en BitTorrent qui est bien plus rapide. Bien
sûr, je l'enregistre dans le dossier /home virtuel, donc au bout d'un moment, le
système est trop rempli et freeze. Je recommence en l'enregistrant sur un disque
dur externe et c'est bon.</p>

<p>Et là, il faut que je change le système qui se trouve sur ma clkef USB que je
suis en train d'utiliser. Chaud !</p>

<pre><code>dd if=F14.iso of=/dev/sdb bs=16M&#x000A;sync&#x000A;</code></pre>

<p>Bien sûr, la commande sync ne marche plus. J’attend donc patiemment que la LED
de la clef USB s'arrête pour éteindre sauvagement l'ordinateur. Je le relance
avec le nouveau système et je peux enfin taper la commande qui va me sauver la
vie:</p>

<pre><code>yum --installroot=/mnt/fedora reinstall glibc&#x000A;&#x000A;Sep 28 11:42:43 Installed: glibc-2.12.90-13.x86_64&#x000A;Sep 28 11:42:57 Installed: glibc-2.12.90-13.i686&#x000A;(je dois préciser que l'ordinateur avait 2h de retard cart l'orloge système&#x000A; est réglée UTC, il était donc réellement 13:42)&#x000A;</code></pre>

<p>J'avais essayé un <code>yum downgrade</code> mais ça prenait trop de temps et impactait
trop de packages. Je peux alors enfin faire un chroot sans segfault:</p>

<pre><code>chroot /mnt/fedora /bin/sh&#x000A;sh#&#x000A;</code></pre>

<p>Miracle!</p>

<p>Je redémarre et tout rentre dans l'ordre.</p>

<p>Note: il s'agit du
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=638091">bug 638091</a></p>
</div></div>
          <div class='clear'></div>
        </div>
        <div class='sub-article'>
          <h2>
            <a class='permalink' href='../../../Blog/2011/01/26/how-i-would-want-blocks-in-lisaac/'>How I Would Want BLOCKs in Lisaac</a>
          </h2>
          <div><p class='meta'>
  <span class='date-time'>
    <span class='date'>Wed 26 Jan 2011,</span>
    <span class='time'>10:22 PM</span>
  </span>
  <span class='tags'>
    <span class='tag'>
      <a class='tag' href='../'>comp</a>
    </span>
    <span class='tag'>
      <a class='tag' href='../../en/'>en</a>
    </span>
    <span class='tag'>
      <a class='tag' href='../../lisaac/'>lisaac</a>
    </span>
  </span>
</p>
<div class='excerpt'>
  <p>Remind me to post about this again ...</p>

<p>Syntax:</p>

<pre><code>BLOCK_PROTO{IN,IN;OUT,OUT}&#x000A;</code></pre>

<p>BLOCK_PROTO.li</p>

<pre><code>Section Header&#x000A;&#x000A;  + name := BLOCK_PROTO;&#x000A;&#x000A;  - how_to_allocate &lt;- clone;&#x000A;&#x000A;Section Public&#x000A;&#x000A;  // Notice there is no + slots as these are generated by the compiler and&#x000A;  // accessed through internals.&#x000A;&#x000A;  - parameter i:INTEGER :E &lt;- Internal;&#x000A;&#x000A;  - upvalues :UPVALUES &lt;- Internal;&#x000A;&#x000A;  - ptr :POINTER &lt;- Internal;&#x000A;</code></pre>

<p>UPVALUES.li contains the upvalues variables that might be shared by several
BLOCKs.</p>

<p>Blocks needs to be objects in the heap to make it possible to pass them around.
Upvalues also needs to be on the heap.</p>
</div></div>
          <div class='clear'></div>
        </div>
        <div class='sub-article'>
          <h2>
            <a class='permalink' href='../../../Blog/2011/02/11/section-interface/'>Section Interface</a>
          </h2>
          <div><p class='meta'>
  <span class='date-time'>
    <span class='date'>Fri 11 Feb 2011,</span>
    <span class='time'>06:54 PM</span>
  </span>
  <span class='tags'>
    <span class='tag'>
      <a class='tag' href='../'>comp</a>
    </span>
    <span class='tag'>
      <a class='tag' href='../../en/'>en</a>
    </span>
    <span class='tag'>
      <a class='tag' href='../../lisaac/'>lisaac</a>
    </span>
  </span>
</p>
<div class='excerpt'>
  <p>I had an idea about inheritance, comming from Eiffel and my today's work in Ada
Object Oriented Programming in embedded software. I am working on a software
that is going to be embedded in an ADIRU (Air Data Inertial Reference Unit) in
the final assembly line (not on air). This software is about implementing a
protocol to let the test operator test the connections in the aircraft.</p>

<p>Embedded software means memory constraints. Basically, that means I can only
allocate new objects when the application is starting up. When the application
is running (with a scheduler), it is no longer possible to create new objects.
This is bad for me because I just want to create different objects at runtime
that have a different behaviour. The objects all have the same size in byte, the
same data. There is just a function that is inherited.</p>

<p>Next, I thought of Eiffel ...</p>

<p>And then about what is inheritance. I can think of two aspects of inheritance:</p>

<ul>
<li>Behaviour inheritance: you just want the same behaviour as your parent. This
is the <code>Section Insert</code></li>
<li>Interface inheritance: you just want the polymorphism</li>
</ul>


<p>When you think about it, the two aspects complements each other. The traditional
inheritance is just the combinaison of the two. So I thought that could be a
great idea to separate them. Bundeling them together would just help programmers
mistakenly inherit for an object, even if they obly want polymorphism or
behavior inheritance alone.</p>

<p>There is another trap: extend an object that you already inherited. You might
add some features/methods/slots that you don't necessarily want in herited
prototypes. You end up cluttering the inherited objects a lot. So I thought that
a good rule would be to forbid the inheritance from an implementation and force
inheritance from interfaces.</p>

<p><strong>And, how to do that nicely in Lisaac?</strong></p>

<p>With the new <code>Section Interface</code></p>

<p>The Section Interface would define an interface for the current prototype. It
would contain slots and their contracts that are going to be inherited. Slots
not defined here will not be available for inheritance. And if there is no
Section Interface, no inheritance will be possible.</p>

<p>In short terms, it means that if you use the Strict version of the prototype (or
if the compiler can infer you are doing so), you can use the slots in the
Section Public. Else, you are limited to the Section Interface.</p>

<p><strong>Cool things with interfaces</strong></p>

<p>Just as in eiffel, if you have two slots that conflicts when inherited like in
the following code:</p>

<pre><code>Section Header&#x000A;&#x000A;  + name := BAG(T);&#x000A;&#x000A;Section Interface&#x000A;&#x000A;  - count :INTEGER;&#x000A;  - lower :INTEGER;&#x000A;  - upper :INTEGER;&#x000A;&#x000A;  - owner :PERSON;&#x000A;</code></pre>

<!--  -->


<pre><code>Section Header&#x000A;&#x000A;  + name := SHOP;&#x000A;&#x000A;Section Inherit&#x000A;&#x000A;  - tomatos :BAG(TOMATOS);&#x000A;  - eggs    :BAG(EGGS);&#x000A;&#x000A;Section Interface&#x000A;&#x000A;  //&#x000A;  // You can rename the slots:&#x000A;  //&#x000A;&#x000A;  - tomatos_count &lt;- tomatos.count;&#x000A;  - tomatos_lower &lt;- tomatos.lower;&#x000A;  - tomatos_upper &lt;- tomatos.upper;&#x000A;&#x000A;  - eggs_count &lt;- eggs.count;&#x000A;  - eggs_lower &lt;- eggs.lower;&#x000A;  - eggs_upper &lt;- eggs.upper;&#x000A;&#x000A;  //&#x000A;  // Or reimplement them:&#x000A;  // (if there is a conflict, it should be present in the interface tell the&#x000A;  //  compiler that you thought of reimplementing it.)&#x000A;  //&#x000A;&#x000A;  - owner :PERSON;&#x000A;&#x000A;Section Public&#x000A;&#x000A;  - owner :PERSON &lt;-&#x000A;  (&#x000A;    ? { eggs.person = tomatos.person };&#x000A;    tomatos.owner&#x000A;  );&#x000A;</code></pre>

<p>This will tell the compiler that when the SHOP transforms into a BAG(TOMATOS)
through polymorphism, it should use the <code>tomatos_count</code> instead of <code>count</code>. This
will also tell that the owner of both the tomatos and eggs is the same and
implemented in SHOP.</p>

<p><strong>How to inherit?</strong></p>

<p>For behaviour inheritance:</p>

<pre><code>Section Insert&#x000A;&#x000A;  - parent1 :Expanded P1;&#x000A;  - parent2 :P2 := P2;&#x000A;  + parent3 :Expanded P3;&#x000A;  + parent4 :P4 := P4;&#x000A;</code></pre>

<p>For interface inheritance (the two forms are equivalent)</p>

<pre><code>Section Inherit&#x000A;&#x000A;  - parent1 :Interface P1;&#x000A;  + parent2 :Interface P2;&#x000A;</code></pre>

<p>For both (if there is no default values for forms 2 and 4 the compiler should
issue a warning):</p>

<pre><code>Section Inherit&#x000A;&#x000A;  - parent1 :Expanded P1;&#x000A;  - parent2 :P2 := P2;&#x000A;  + parent3 :Expanded P3;&#x000A;  + parent4 :P4 := P4;&#x000A;</code></pre>
</div></div>
          <div class='clear'></div>
        </div>
        <div class='sub-article'>
          <h2>
            <a class='permalink' href='../../../Blog/2011/03/22/freedombox/'>Freedombox</a>
          </h2>
          <div><p class='meta'>
  <span class='date-time'>
    <span class='date'>Tue 22 Mar 2011,</span>
    <span class='time'>09:26 AM</span>
  </span>
  <span class='tags'>
    <span class='tag'>
      <a class='tag' href='../'>comp</a>
    </span>
    <span class='tag'>
      <a class='tag' href='../../en/'>en</a>
    </span>
    <span class='tag'>
      <a class='tag' href='../../freedombox/'>freedombox</a>
    </span>
  </span>
</p>
<div class='excerpt'>
  <p>Yesterday, I realized that we all needed to protect our privacy and that we
might be facing something more than just ads. The solution, fortunately it was started: <a href="http://www.freedomboxfoundation.org/">Freedombox</a></p>

<p>There is a specific part I want to cover: protected communication channels.
Starting with E-Mails.</p>

<p>In the E-Mail world, GMail is the best, in my opinion, except that it is hoisted
on Google servers. How about having a private GMail on your freedombox ? What
are the use cases:</p>

<ul>
<li><p>We need to know which server sent the E-mail or tell the user if we can't
know. Solutions exists like <a href="http://en.wikipedia.org/wiki/DomainKeys_Identified_Mail">DKIM</a>,
<a href="http://en.wikipedia.org/wiki/DomainKeys">DomainKeys</a> or <a href="http://en.wikipedia.org/wiki/Sender_Policy_Framework">SPF</a>.
The solution liew with all of thesesolution, not merely just one.</p>

<p>What we should see is before the E-mail a little line telling something
like:</p>

<ul>
<li><p>We could not determine which server sent the E-Mail, it might be spam or
scam.</p></li>
<li><p>We could not determine which server sent the E-Mail, it appears to come
from google.com but google.com generally signs outgoing E-mails. This is
probably spam or scam.</p></li>
<li><p>The E-Mail was sent from google.com</p></li>
<li><p>The E-Mail was sent from toto31.freedombox.net and has been signed by
sender@toto31.freedombox.net.</p></li>
<li><p>The E-Mail was sent from toto31.freedombox.net and has been encrypted by
sender@toto31.freedombox.net.</p></li>
</ul>
</li>
</ul>


<p>Now, the freedombox provides many services. For example we need to have a PGP
Key server. How do we advertise that? DNS was made for that. I was thinking
specifically about <a href="http://avahi.org/">Avahi</a>, providing Multicast-DNS on the
local network. I think we need to either transform Avahi into a full DNS server
that could run on the Freedombox or have it publish records in an existing DNS
server on the box. Why? Because services are already used to publish DNS records
using Avahi.</p>

<p>We also need to have a network of Freedombox to add redundancy to our DNS
servers. That could be implemented as a second part.
It would also be good if we could have a domain like freedombox.net where all
freedombox could have a free subdomain for free. Domain names are a necessity.</p>

<p>Now, what I want to do is simple:</p>

<ul>
<li>Buy a plug computer and install Freedombox on it</li>
<li>Work on integrating a SMTP server that would

<ul>
<li>send signed E-Mails</li>
<li>receive E-Mails and filter them</li>
</ul>
</li>
<li>Integrate an IMAP server</li>
<li>Integrate a PGP Key server</li>
<li>Work on integration with DNS</li>
<li>Work on a client that would sign e-mails, send them and open the inbox on
IMAP</li>
</ul>


<p>Now, it would be freat to have in all modern browsers a <code>dns:</code> scheme which
would present all the services of a specific server. For example it could tell
you:</p>

<ul>
<li>This server provides a web server. <em>Browse</em></li>
<li>This server provides a LDAP address book. <em>Browse</em> <em>Search</em></li>
<li>This server provides an XMPP server. <em>Sign-In</em></li>
<li>This server provides a SMTP server. <em>Send E-Mail</em></li>
</ul>


<p>This would be awesome.</p>
</div></div>
          <div class='clear'></div>
        </div>
        <div class='sub-article'>
          <h2>
            <a class='permalink' href='../../../Blog/2011/03/22/update-bind-dns-from-avahi/'>How to update your Bind DNS Server from Avahi</a>
          </h2>
          <div><p class='meta'>
  <span class='date-time'>
    <span class='date'>Tue 22 Mar 2011,</span>
    <span class='time'>10:10 AM</span>
  </span>
  <span class='tags'>
    <span class='tag'>
      <a class='tag' href='../'>comp</a>
    </span>
    <span class='tag'>
      <a class='tag' href='../../en/'>en</a>
    </span>
    <span class='tag'>
      <a class='tag' href='../../freedombox/'>freedombox</a>
    </span>
  </span>
</p>
<div class='excerpt'>
  <p>Attention: this post contains wrong information. What I discovered wasn't a way
tu publish services to a DNS server but publish local workstations to the DNS.</p>

<p>Following my previous post, I wondered how to update the DNS server from Avahi.
<a href="http://www.gamers-forum.com/showthread.php?t=17882">I was not alone</a>. I found a script that could be run as a cron job that
does the job. The next step is to use Avahi notifications instead of pooling
every minute.</p>

<!--

Now, the script (in PHP, better to rewrite in something sensible):

    #!/usr/bin/php

    <?php
    $avahidata = explode("\n",`avahi-browse -ptr _workstation._tcp`);

    $hosts="server localhost\nzone local\n";
    $pointers="server localhost\nzone 0.168.192.in-addr.arpa\n";

    $oldhosts="server localhost\nzone local\n";
    $oldpointers="server localhost\nzone 0.168.192.in-addr.arpa\n";

    for($i=0;$i<count($avahidata)-1;$i++){
        $hostInformation=explode(";",$avahidata[$i]);
        if($hostInformation[0] != "=") continue;

        $hostname=$hostInformation[6];
        $hostaddr=$hostInformation[7];
        $ptraddr=implode(".",array_reverse(explode(".",$hostaddr)));

        $hosts.="update add $hostname 2400 A $hostaddr\n";
        $pointers.="update add $ptraddr.in-addr.arpa 2400 PTR $hostname\n";

        $oldhosts.="update delete $hostname A\n";
        $oldpointers.="update delete $ptraddr.in-addr.arpa PTR\n";
    }

    $hosts.="send\n";
    $pointers.="send\n";

    $oldhosts.="send\n";
    $oldpointers.="send\n";

    echo `cat .dns_purge_hosts | nsupdate`;
    echo `cat .dns_purge_pointers | nsupdate`;

    echo `echo "$hosts" | nsupdate`;
    echo `echo "$pointers" | nsupdate`;

    file_put_contents(".dns_purge_hosts",$oldhosts);
    file_put_contents(".dns_purge_pointers",$oldpointers);

    ?>

And configure Bind to allow updates from localhost:

    acl lan { 192.168.0/24; 127.0.0.1; };

    options {
        directory "/var/named";
        pid-file "/var/run/named/named.pid";
        auth-nxdomain yes;
        datasize default;
        listen-on { any; };
        forward first;
        forwarders {
            8.8.8.8;
            8.8.4.4;
        };
    };

    zone "local" {
        type master;
        file "local.zone";
        check-names ignore;
        allow-transfer { lan; };
        allow-update { lan; };
    };

    zone "0.168.192.in-addr.arpa" {
        type master;
        file "0.168.192.in-addr.arpa.zone";
        check-names ignore;
        allow-transfer { lan; };
        allow-update { lan; };
    };

-->


<p>Thanks to <a href="http://gamers-forum.com/member.php?u=35088">leica</a></p>

<p>edit: probably a better solution would to still use mDNS over unicast DNS (wide
area). See a post from <a href="http://0pointer.de/blog/projects/avahi-wide-area.html">Lennart Poettering</a>.</p>
</div></div>
          <div class='clear'></div>
        </div>
        <div class='sub-article'>
          <h2>
            <a class='permalink' href='../../../Blog/2011/03/23/freedombox-connectivity/'>Freedombox Connectivity</a>
          </h2>
          <div>
                            <p class='meta'>
                              <span class='date-time'>
                                <span class='date'>Wed 23 Mar 2011,</span>
                                <span class='time'>09:21 AM</span>
                              </span>
                              <span class='tags'>
                                <span class='tag'>
                                  <a class='tag' href='../'>comp</a>
                                </span>
                                <span class='tag'>
                                  <a class='tag' href='../../en/'>en</a>
                                </span>
                                <span class='tag'>
                                  <a class='tag' href='../../freedombox/'>freedombox</a>
                                </span>
                              </span>
                            </p>
                            <div class='excerpt'>
                              <p>Suppose we want to have an E-Mail server on the freedombox. We need connectivity
                              for SMTP, the ability to accept inbound connections. Which is impossible behind
                              a NAT.</p>
                              
                              <p>For E-Mails we also need a MX record in the DNS ... This is a problem if the
                              network is completely hostile. In which case, the only solution is to have a
                              somewhat P2P DNS database shared on freedombox. Access would then not be
                              possible from the Internet.</p>
                              
                              <p>Now, more likely, we are only going to have access to a dynamix DNS, which is
                              fine. The DNS would store records A, AAAA and MX. Perhaps some others. Still, we
                              need not to rely on them too much and have the ability to communicate from
                              freedombox to another even if there is no DNS for us.</p>
                              
                              <p>So ... it comes down to the firewall and NAT restrictions.</p>
                              
                              <p>I suppose we could:</p>
                              
                              <ul>
                              <li><p>First, autoconfigure IPv4 and IPv6</p></li>
                              <li><p>Try opening NAT ports using UPnP</p></li>
                              <li><p>Check the IP connectivity. We suppose IPv6 is accessible from the Internet and
                              we look to see if the IPv4 is in a range that is routable (not in a private
                              non-routable range).</p>
                              
                              <p>Additionally, we could ask a service on the Internet to test our connectivity
                              if such a service is available. Both for IPv4 and IPv6.</p></li>
                              <li><p>If we don't have an IPv6 connectivity, open a tunnel to the IPv6 Internet.
                              Either Toredo or a manually configured tunnel if available.</p></li>
                              <li><p>Update our DNS record</p></li>
                              </ul>
                              
                              
                              <p>So now, we have at least IPv6 available ... and we can at least communicate with
                              the v6 Internet.</p>
                            </div>
                          </div>
          <div class='clear'></div>
        </div>
      </div>
      <div class='page-list'>
        <strong>Page:</strong>
        <ul class='page-list'>
          <li>
            <strong>1</strong>
          </li>
          <li>
            <a href='../2/'>2</a>
          </li>
          <li>
            <a href='../3/'>3</a>
          </li>
          <li>
            <a href='../'>latest</a>
          </li>
        </ul>
      </div>
      <div class='clear'></div>
    </div>
    <div class='clear'></div>
    <div class='footer'>
      <hr>
      <p>E-mail: <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#37;&#54;&#68;&#37;&#54;&#57;&#37;&#54;&#67;&#37;&#54;&#52;&#37;&#55;&#50;&#37;&#54;&#53;&#37;&#54;&#52;&#37;&#50;&#68;&#37;&#55;&#48;&#37;&#55;&#53;&#37;&#54;&#50;&#37;&#52;&#48;&#37;&#54;&#68;&#37;&#54;&#57;&#37;&#54;&#67;&#37;&#54;&#52;&#37;&#55;&#50;&#37;&#54;&#53;&#37;&#54;&#52;&#37;&#50;&#69;&#37;&#54;&#54;&#37;&#55;&#50;">&#109;&#105;&#108;&#100;&#114;&#101;&#100;&#45;&#112;&#117;&#98;&#64;&#109;&#105;&#108;&#100;&#114;&#101;&#100;&#46;&#102;&#114;</a></p>
      <p>Mildred's Website: <a href="http://mildred.fr">http://mildred.fr</a>.
      I try to have <a href="http://www.w3.org/Provider/Style/URI">cools URI that don't change</a>.</p>
    </div>
  </body>
</html>
