<!DOCTYPE html>
<html>
  <head>
    <title>A New Architecture for the Web - Mildred's Website</title>
    <meta charset='utf-8'>
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta content='en, idea, web' name='keywords'>
    <meta content='' name='description'>
    <meta content='initial-scale=1.0, width=device-width' name='viewport'>
    <meta content='article' name='x-kind'>
    <link href='http://mildred.fr/Blog/2012/07/26/a_new_architecture_for_the_web/' rel='canonical'>
    <link href='../../../../../favicon.png' rel='icon' type='image/png'>
    <link href='../../../../../favicon.png' rel='shortcut icon' type='image/png'>
    <link href='../../../../../style.css' media='screen' rel='stylesheet' type='text/css'>
    <script src='../../../../../Scripts/json/json2.js' type='text/javascript'></script>
    <script src='../../../../../Scripts/jquery.min.js' type='text/javascript'></script>
    <script src='../../../../../Scripts/comments.js' type='text/javascript'></script>
    <script src='../../../../../Scripts/local.js' type='text/javascript'></script>
    <link rel="index" href="../../../../index.html" />
  </head>
  <body>
    <div class="header">
      <p class="access-links">
        <a href="#menu">Go to Menu</a>
        <br>
        <a href="#content">Go to Content</a>
      </p>
      <div class="left">
        <a href="../../../../../">
          <img alt="My photo" class="photo" src="../../../../../Images/IMG_5669_square_128.jpeg">
        </a>
      </div>
      <div class="title">
        <h1>
          <a href="../../../../../">Mildred's Website</a>
        </h1>
      </div>
      <div class="float-right"></div>
      <div class="clear-right"></div>
      <div class="right">
        <strong>Tags:</strong>
        <ul class="tags">
          <li>
            <a class="tag" href="../../../../../tags/cobra/">cobra</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/comp/">comp</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/configuration/">configuration</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/dev/">dev</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/dream/">dream</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/en/">en</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/fedora/">fedora</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/fr/">fr</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/freedombox/">freedombox</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/git/">git</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/html/">html</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/idea/">idea</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/liens/">liens</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/lisaac/">lisaac</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/lysaac/">lysaac</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/misc/">misc</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/photos/">photos</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/physics/">physics</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/politique/">politique</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/privacy/">privacy</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/srs/">srs</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/test/">test</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/web/">web</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/website/">website</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/wwwgen/">wwwgen</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/wwwsupport/">wwwsupport</a>
          </li>
        </ul>
      </div>
      <div class="content">
        <div class="links" id="menu">
          <ul>
            <li>
              <a href="../../../../../">Home</a>
            </li>
            <li>
              <a href="../../../../">Blog</a>
            </li>
            <li>
              <a href="//survie.mildred.fr">Survie</a>
            </li>
          </ul>
        </div>
      </div>
      <div class="clear"></div>
    </div>
    <div class="leftcol">
      <img alt="My avatar" class="photo" src="../../../../../Images/all128.jpeg">
      <hr>
      <p>GoogleTalk, Jabber, XMPP address:
      <br /><strong><a href="xmpp:mildred&#64;jabber.fr">mildred&#64;jabber.fr</a></strong><!--&nbsp;<img src="http://presence.jabberfr.org/2dc519ffec76a836c2f2c2f66ac38291/image-dcraven.png" alt="" /><br /><em><script type="text/javascript" src="http://presence.jabberfr.org/2dc519ffec76a836c2f2c2f66ac38291/message_js.js"></script></em>-->
      </p>
      <hr>
      <p>
        <a href="../../../../../gpg_key.txt">GPG Public Key</a>
        <br>
        <span style="font-size: 0.8em">
          (Fingerprint 197C A7E6 645B 4299 6D37 684B 6F9D A8D6 9A7D 2E2B)
        </span>
      </p>
    </div>
    <div class='main' id='content'>
      <h1>A New Architecture for the Web</h1>
<p class='meta'>
  <span class='date-time'>
    <span class='date'>Thu 26 Jul 2012,</span>
    <span class='time'>12:37 PM</span>
  </span>
  <span class='author'>
    by
    <span class='author-name'>
      Mildred Ki'Lya
    </span>
  </span>
  <span class='tags'>
    <span class='tag'>
      <a class='tag' href='../../../../../tags/en/'>en</a>
    </span>
    <span class='tag'>
      <a class='tag' href='../../../../../tags/idea/'>idea</a>
    </span>
    <span class='tag'>
      <a class='tag' href='../../../../../tags/web/'>web</a>
    </span>
  </span>
</p>
<div class='body'><p>I want a new architecture for the web. But what web ?</p>

<h2>The Traditional Web</h2>

<p>A Web Site is a collection of Web Pages. A Web Page is a document, a
static document I might add. The document contains text, images, sound
and videos to present some information to the public. This is the
traditional version of the web that I respect very much.</p>

<p>There is no need to change this as it works very well. The web was
designed to allow a collection of documents to be accessed and does the
job very well</p>

<p>The one this that is sensible to do however is not to use any scripting
language to render the content of the pages. By definitions, these pages
are static, using a scripting language like PHP is not only going to be
inefficient, but is going to be a security risk.</p>

<h2>Web Applications</h2>

<p>This is an entire different thing, and the way we do this is completely
wrong. We think that a web application is a collection of dynamic web
pages. This should be erased from your mind.</p>

<p><strong>A Web Application is an application of its own right.</strong></p>

<p>Most unfortunately, applications are written in HTML which is not suited
for this purpose. The widgets are very few and the framework is not
suited to create complex User Interfaces.</p>

<h3>The very bad thing to do</h3>

<p><strong>You should not do this.</strong> Unfortunately, this is how it works for most.</p>

<p>A very bad programmer is going to create a web page for each of the
different aspects of its program. The web page would be dynamically
generated on the server using a template engine. Some JavaScript would
be included in this mess to avoid refreshing a page while in fact you
should.</p>

<p>This is bad because you'll have a ton of page refresh, and that's bad
for the user. If you're not using JavaScript, this is the old way of web
applications and is acceptable, but if you're using JavaScript for more
than a few things, it's bad.</p>

<p>You shouldn't use JavaScript to change the content of a page to match
what the server would generate just to avoid a refresh. Just because
this is just a way to recreate a template engine on the client that is
redundant with the one on the server.</p>

<p>And if you are using JavaScript to change the content of a page to get
the content that you should generally see in another page, you're a
moron. This breaks the back/forward mechanism and is very bad.</p>

<p>The only sensible thing to do  in this configuration with JavaScript is
to script the user interface. Show hidden sections, enable a button.
Don't contact the server using AJAX, you are already getting information
from the server using normal page reload.</p>

<h3>The sensible thing to do</h3>

<p><strong>Please do this!!!</strong></p>

<p>An application is an application. It's a bundle and can't be separated
into pages. It can be separated into sub-sections if you want, but those
will necessarily trigger a page refresh.</p>

<p>The application should be the equal of a desktop application using a
native toolkit, except that web technologies are used instead.
Contacting the server should be limited to what is necessary only
(fetching resources, exchange data, ...). In particular, the templates
should be on the client side.</p>

<p>On the server side, you'd have just a classic Web API, and static
resources. The Web API should be designed with care and security in
mind. It should be easily shared with third parties that want to
integrate within your application.</p>

<p>It is as simple as that:</p>

<ul>
<li>Server = Web API + Resources</li>
<li>Client = UI (incl templates)</li>
</ul>


<p>I heard that SproutCore is a solution to work this way, but it was
horrible to use it as well.</p>

<p>Perhaps, we need to get away from frameworks, there are many solutions
that can integrate well together and that don't need a framework. Read
this article for example: <a href="http://blog.getify.com/grab-ui-by-the-handlebar/">Grab UI by the Handlebar</a></p>

<h2>An Example</h2>

<p>I have a very simple example to show you what I mean, the comment
mechanism on this website. Each page contain a JavaScript script (just
look at the sources) that will add the comment features. The page
delivered by the server contain no information about the comments,
except a <code>&lt;noscript&gt;</code> tag to tell the people without JavaScript that
they miss the comments.</p>

<p>The script does an AJAX query on a third party server (with PHP and a
database). The arguments are the URL of the page and the answer is the
JSON formatted list of comments for the page. These comments are then
presented on the page. (The refresh link does this again)</p>

<p>The script also creates a form to add a comment. When the form is
submitted, an AJAX query is made with the URL of the page and the
content of the comment as arguments.</p>

<p>This is how all web applications should work.</p>

<h2>Going further: static databases on the server</h2>

<p>I already wrote an article on this, but I'll summarize the idea here.</p>

<p>With this new idea for web applications, the application logic is moved
from the server to the client. Perhaps not all the way, but for simple
applications like the comments above, the server API is nothing much
than a fancy database API.</p>

<p>Why not model a database on this model? But it already exists:
<a href="https://en.wikipedia.org/wiki/CouchDB">CouchDB</a>. This is a database which API is a web API. I want to
take the principles of this database and mix them with the ideas of a
static page generator.</p>

<p>The idea is that read only access when the resource URL is known, a
static page should correspond to the URL and a classic web server should
answer the query.</p>

<p>Only update and search queries would be filtered by the web server to a
FastCGI application that is going to update the static files, or look at
them to answer the search.</p>

<p>I find it difficult to find advantages of this compared to CouchDB.
There is one thing, your data will always be accessible read only. No
obscure database format that require a database server that might not
work on new hardware, might not be maintained any more...</p>

<h2>Conclusion</h2>

<p>With this approach, most web applications could be composed of static
assets that are accessing a database with a Web API. The static assets
and the database could be on the same server or on a different one. No
limit is posed here, except the same origin restriction of web browsers.</p>

<p>Fortunately, a new standard (that I'm using for the comments of this
website) let you specify if the same origin policy should apply or not:
<a href="http://www.w3.org/TR/access-control/">Cross-Origin Resource Sharing</a></p>

<h2>What about Cookies Then?</h2>

<p><strong>They should not exist in their current form.</strong></p>

<p>This was a late addition to the HTTP standard, because it was already
implemented. It was never really thought of, and is a breach of the
original HTTP model.</p>

<p><strong>The cookies are what allows XSS vulnerabilities, NOT JavaScript</strong></p>

<p>The current web community takes the things the wrong way. Instead of
damning cookies forever, they blame on JavaScript and try to build walls
all over the place to avoid XSS while there is a most simple solution.</p>

<h3>What are XSS?</h3>

<blockquote><p>Cross-site scripting (XSS) is a type of computer security vulnerability typically found in Web applications, such as web browsers through breaches of browser security, that enables attackers to inject client-side script into Web pages viewed by other users. A cross-site scripting vulnerability may be used by attackers to bypass access controls such as the same origin policy. Cross-site scripting carried out on websites accounted for roughly 84% of all security vulnerabilities documented by Symantec as of 2007.[1] Their effect may range from a petty nuisance to a significant security risk, depending on the sensitivity of the data handled by the vulnerable site and the nature of any security mitigation implemented by the site's owner.</p></blockquote>

<p>(Source: <a href="https://en.wikipedia.org/wiki/Cross-site_scripting">Wikipedia</a>)</p>

<p>This is a wrong way to look at the problem. Inclusion of other items in
web pages dates from the very beginning. It is the foundation of the
web. What allows to have rich documents, with links between them. The
same origin policy is just one of these walls that I talked about, that
assumes that all pages on the current domain can be trusted. Is that true?</p>

<p>The real story is that if the design of the web was correct, the script
injected by attackers in web pages would be completely harmless. The
same origin policy shouldn't exist and bypassing it should be by no mean
be a security risk.</p>

<p>We have come to a situation where WebGL can be a security risk because
it can determine the colours of an image included in the web page. Just
because an image can, from the very beginning of the web, bypass the
same origin policy. Some people say that images should respect the same
origin policy, but what they don't imagine is that we could just forget
all of this mess.</p>

<h3>The Real Problem.</h3>

<p>The <em>real</em> problem is that when loading foreign content, though AJAX,
the use of images or whatever, a page can load a foreign page where you
are logged in using cookies. And access your foreign account. For
example your bank account.</p>

<p>The problem is that the page containing the XSS script was granted the
access to the cookie protecting your bank account.</p>

<p><strong><em>Why the hell your bank account is just protected by a cookie than any
page can have access to???</em></strong></p>

<h3>The solution</h3>

<p>Unless you have in your address bar the address of your bank, the cookie
protecting your bank account should be locked away. In fact, instead of
having everything in a page respect the same origin policy, <strong>cookies
should be the single thing respecting the same origin policy;</strong></p>

<p>This is just a change in the handling of the cookie by the browser. Not
a very big change at that. Only cookies for the domain in the address
bar should be exploitable. But it would break a number of assumption:</p>

<p>Third party cookies would no longer exist, this would be a big shock for
advertisers and tracking programs. A loss for these companies, but a win
for personal privacy.</p>

<h4>Allow third party cookies nonetheless</h4>

<p>We could nonetheless allow third party cookies, but only in the context
of a specific page:</p>

<ul>
<li>each tab/window of the browser share the same cookie jar for the requests</li>
<li>for each tab/window, a separate cookie jar would be assigned that will
be emptied when a link is followed to a different origin</li>
<li>the sub-elements of a page that are not of the same origin of the page
itself, should have their cookies in the sub cookie jar only</li>
<li>if there are sub-sub elements, they should be assigned to a sub-sub
cookie jar recursively.</li>
</ul>


<h4>Allow third party cookies to access the main cookie jar on demand</h4>

<p>This would nonetheless break a number of things. Third party scripts
expect to see the same cookies they set a while ago, even if it was not
on the same page.</p>

<p>A solution to this problem would be to add an option in the browser UI
to specifically allow a third party script in a page to access the
global cookie jar. There would be a button saying for example "Some
cookies have been blocked". When clicked it would open a menu with:</p>

<ul>
<li>Allow access to ad.doubleclick.com</li>
<li>Allow access to facebook.com</li>
<li>Allow access to my-bank.com</li>
</ul>


<p>A sensible person would not allow a blog with an XSS script access his
bank website, but would allow facebook if he wants to use a facebook button.</p>

<h4>Browser plugins, anyone ?</h4>

<p>I'd love a browser plugin for that !</p>

<p>Unfortunately, on Firefox, creating sub cookie jar would be difficult
due to the architecture of it. Webkit is better on that.</p>

<h3>Conclusion</h3>

<p>Cookies aren't necessarily bad, they should just respect the same origin
policy they introduced instead of imposing it to all of the other
elements of a page. This can already be done now in web browsers, it
just needs a consensus. Or at least, an extension with the right UI to
bypass the same origin on demand when the scripts needs to.</p></div>
      <noscript>
        <p>
          Scripts are disabled on your computer. In order to access existing
          comments and post new comments, you need to enable Javascript.
        </p>
        <p>
          Rationale: This server that hosts my website is a static server.
          In order to implement comments, a XmlHttpRequest is made on an API
          server to both retrieve the comments and post a new comment.
        </p>
      </noscript>
      <div class='clear'></div>
    </div>
    <div class='clear'></div>
    <div class='footer'>
      <hr>
      <p>E-mail:
        <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#37;&#54;&#68;&#37;&#54;&#57;&#37;&#54;&#67;&#37;&#54;&#52;&#37;&#55;&#50;&#37;&#54;&#53;&#37;&#54;&#52;&#37;&#50;&#68;&#37;&#55;&#48;&#37;&#55;&#53;&#37;&#54;&#50;&#37;&#50;&#68;&#37;&#51;&#49;&#37;&#52;&#48;&#37;&#54;&#68;&#37;&#54;&#57;&#37;&#54;&#67;&#37;&#54;&#52;&#37;&#55;&#50;&#37;&#54;&#53;&#37;&#54;&#52;&#37;&#50;&#69;&#37;&#54;&#54;&#37;&#55;&#50;">&#109;&#105;&#108;&#100;&#114;&#101;&#100;&#45;&#112;&#117;&#98;&#45;&#49;&#64;&#109;&#105;&#108;&#100;&#114;&#101;&#100;&#46;&#102;&#114;</a>
      </p>
      <p>Mildred's Website: <a href="http://mildred.fr">http://mildred.fr</a>.
      I try to have <a href="http://www.w3.org/Provider/Style/URI">cools URI that don't change</a>.</p>
    </div>
  </body>
</html>
