<!DOCTYPE html>
<html>
  <head>
    <title>Static website architecture - Mildred's Website</title>
    <meta charset='utf-8'>
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta content='en, website' name='keywords'>
    <meta content='' name='description'>
    <meta content='initial-scale=1.0, width=device-width' name='viewport'>
    <meta content='article' name='x-kind'>
    <link href='http://mildred.fr/Blog/2011/04/24/static_website_architecture/' rel='canonical'>
    <link href='../../../../../favicon.png' rel='icon' type='image/png'>
    <link href='../../../../../favicon.png' rel='shortcut icon' type='image/png'>
    <link href='../../../../../style.css' media='screen' rel='stylesheet' type='text/css'>
    <script src='../../../../../Scripts/json/json2.js' type='text/javascript'></script>
    <script src='../../../../../Scripts/jquery.min.js' type='text/javascript'></script>
    <script src='../../../../../Scripts/comments.js' type='text/javascript'></script>
    <script src='../../../../../Scripts/local.js' type='text/javascript'></script>
    <link rel="index" href="../../../../index.html" />
  </head>
  <body>
    <div class="header">
      <p class="access-links">
        <a href="#menu">Go to Menu</a>
        <br>
        <a href="#content">Go to Content</a>
      </p>
      <div class="left">
        <a href="../../../../../">
          <img alt="My photo" class="photo" src="../../../../../Images/IMG_5669_square_128.jpeg">
        </a>
      </div>
      <div class="title">
        <h1>
          <a href="../../../../../">Mildred"s Website</a>
        </h1>
      </div>
      <div class="float-right"></div>
      <div class="clear-right"></div>
      <div class="right">
        <strong>Tags:</strong>
        <ul class="tags">
          <li>
            <a class="tag" href="../../../../../tags/cobra/">cobra</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/comp/">comp</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/configuration/">configuration</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/dev/">dev</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/dream/">dream</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/en/">en</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/fedora/">fedora</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/fr/">fr</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/freedombox/">freedombox</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/git/">git</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/html/">html</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/idea/">idea</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/liens/">liens</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/lisaac/">lisaac</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/lysaac/">lysaac</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/misc/">misc</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/photos/">photos</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/physics/">physics</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/politique/">politique</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/privacy/">privacy</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/srs/">srs</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/test/">test</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/web/">web</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/website/">website</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/wwwgen/">wwwgen</a>
          </li>
          <li>
            <a class="tag" href="../../../../../tags/wwwsupport/">wwwsupport</a>
          </li>
        </ul>
      </div>
      <div class="content">
        <div class="links" id="menu">
          <ul>
            <li>
              <a href="../../../../../">Home</a>
            </li>
            <li>
              <a href="../../../../">Blog</a>
            </li>
            <li>
              <a href="//survie.mildred.fr">Survie</a>
            </li>
          </ul>
        </div>
      </div>
      <div class="clear"></div>
    </div>
    <div class="leftcol">
      <img alt="My avatar" class="photo" src="../../../../../Images/all128.jpeg">
      <hr>
      <p>GoogleTalk, Jabber, XMPP address:
      <br /><strong><a href="xmpp:mildred&#64;jabber.fr">mildred&#64;jabber.fr</a></strong><!--&nbsp;<img src="http://presence.jabberfr.org/2dc519ffec76a836c2f2c2f66ac38291/image-dcraven.png" alt="" /><br /><em><script type="text/javascript" src="http://presence.jabberfr.org/2dc519ffec76a836c2f2c2f66ac38291/message_js.js"></script></em>-->
      </p>
      <hr>
      <p>
        <a href="../../../../../gpg_key.txt">GPG Public Key</a>
        <br>
        <span style="font-size: 0.8em">
          (Fingerprint 197C A7E6 645B 4299 6D37 684B 6F9D A8D6 9A7D 2E2B)
        </span>
      </p>
    </div>
    <div class='main' id='content'>
      <h1>Static website architecture</h1>
<p class='meta'>
  <span class='date-time'>
    <span class='date'>Sun 24 Apr 2011,</span>
    <span class='time'>09:13 PM</span>
  </span>
  <span class='tags'>
    <span class='tag'>
      <a class='tag' href='../../../../../tags/en/'>en</a>
    </span>
    <span class='tag'>
      <a class='tag' href='../../../../../tags/website/'>website</a>
    </span>
  </span>
</p>
<div class='body'><p>This website is made of static pages. I see two good reasons for that: first,
there is no need to recompute endlessly the same information. Then, with static
pages, you can leave your web site online forever without having it defaced.</p>

<p>So, how to create a modern web site with that? First, I have to start with what
I want:</p>

<ul>
<li>A blog, with the recent posts on the front page</li>
<li>An atom feed with the recent posts as well</li>
<li>Older posts on other pages</li>
<li>Each posts categorized in tags</li>
<li>Each tag having a page with posts in it</li>
<li>The tags pages must have atom feeds as well</li>
<li>And tag pages must be splitted in pages</li>
<li>Posts can have comments, anyone can add a comment</li>
</ul>


<p>This can be achieved using an off-line compiler that creates a hierarchy of HTML
files. Many of these compilers exists, I choose <a href="http://nanoc.stoneship.org">nanoc</a>,
but I had to customize it, mostly using <a href="http://github.com/mgutz/nanoc3_blog">nanoc3_blog</a>.</p>

<p>Some features can be easily provided:</p>

<ul>
<li>The atom feed can be created using a helper included in nanoc</li>
<li>The tags can be easily crafted using page attributes.</li>
<li>Tag pages can be created on the fly using a hand-made helper</li>
<li>Pagination can be done the same way</li>
</ul>


<p>Now, a word about design:</p>

<p><strong>Pagination,</strong> this is frowned upon by the nanoc author as demonstrated on the
<a href="http://nanoc.stoneship.org/docs/6-guides/#paginating-articles">guide</a>:</p>

<blockquote><p>First, a word of caution: I am not a fan of paginating items. Even though
pagination is fairly easy to do in nanoc, I recommend not doing it, for one
specific reason. Every time an object is added to a paginated collection, one
object shifts from one page to the next. When a paginated page is bookmarked,
it may show entirely different content a month later, and when a paginated
page turns up as a result on a search engine, it may no longer contain the
content that the person was looking for anymore. To avoid these issues, I
recommend creating separate pages for each category, tag or year. Having said
all this, Iâ€™ll nonetheless show you how to do pagination in nanoc, so you can
get an idea of how it can be done.</p></blockquote>

<p>In order to avoid having the object shifting pages, the most simple solution is
to have the pages remain static. Say you want to have 10 items per page, the
first page starts empty until it has 10 items. When an 11th item is added, a
second page is created with one element. For blogs, it might seem to be in
reverse order, but for archives, this is not a bad solution.</p>

<p>The pagination system must be uniform and available for any page on the website.
This way, the index page and tag page can have the same pagination system. The
pagination system must also support creating atom feeds. This way, we can have
a feed for the whole blog and a feed per tag. In nanoc, this can be done using
alternative representations for an item.</p>

<p><strong>Comments,</strong> can be done using JavaScript. For a first solution, this is
acceptable, even though having a solution working with user agents without
javascript is a goal. For this, we can use jQuery and XmlHttpRequest. Because
the server only provides static pages, XmlHttpRequest, having a same-origin
policy, will refuse to work. There are several solutions:</p>

<ul>
<li>Proxy the foreign resource on the local server. This unfortunately requires
<code>mod_proxy</code> which is not available on my server.</li>
<li>Another solution is to use <a href="http://www.w3.org/TR/cors/">Cross Origin Resource Sharing</a>, a W3C
recommendation that is still a draft unfortunately, but is started to be
implemented.</li>
<li>Or to use an iframe with a page of the foreign server, and use the
postMessage method to communicate with it, for example with the
<a href="https://github.com/oyvindkinsey/easyXDM/">easyXDM</a> library.</li>
<li>Or use HTML <code>&lt;form&gt;</code> element to post the comment on the the API server. The
server would then include the comment on the static page and publish it.
This unfortunately requires a server with more than a simple php scripting
ability. I don't have this.</li>
</ul>


<p>For now, I am using the XmlHttpRequest solution with the CORS mechanism on the
API server to allow communication. Here is where I'd like to move:</p>

<ul>
<li>First, integrate <a href="https://github.com/oyvindkinsey/easyXDM/">easyXDM</a> for wider browser compatibility, at the
cost of the design.</li>
<li>Then, use a variation of the static HTML form.</li>
</ul>


<p>For the static form, here is what i'm thinking of:</p>

<ul>
<li>First, the client can POST the form on the PAI server. If XmlHttpRequest
with CORS is available, this can be done using Ajax, else we have to deal
with a page reload.</li>
<li>The server would store this message on the database with a unique UUID.</li>
<li>Other clients can access this message accessing the API server as usual.</li>
<li>Frequently, on my computer, I would dump the messages on the API server
database and put them in a local yaml file. Comments i'd like to remove can
then be removed here.</li>
<li>When the site is regenerated, a nanoc helper would read this yaml file and
put comments statically in the page. The page would then be published and
comments would be available to users without javascript.</li>
<li>The script that fetches comments would ignore received comments that are
already present statically on the page, based on the UUID.</li>
</ul>


<p>This way, comments would be available for everyone.</p></div>
      <noscript>
        <p>
          Scripts are disabled on your computer. In order to access existing
          comments and post new comments, you need to enable Javascript.
        </p>
        <p>
          Rationale: This server that hosts my website is a static server.
          In order to implement comments, a XmlHttpRequest is made on an API
          server to both retrieve the comments and post a new comment.
        </p>
      </noscript>
      <div class='clear'></div>
    </div>
    <div class='clear'></div>
    <div class='footer'>
      <hr>
      <p>E-mail:
        <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#37;&#54;&#68;&#37;&#54;&#57;&#37;&#54;&#67;&#37;&#54;&#52;&#37;&#55;&#50;&#37;&#54;&#53;&#37;&#54;&#52;&#37;&#50;&#68;&#37;&#55;&#48;&#37;&#55;&#53;&#37;&#54;&#50;&#37;&#50;&#68;&#37;&#51;&#49;&#37;&#52;&#48;&#37;&#54;&#68;&#37;&#54;&#57;&#37;&#54;&#67;&#37;&#54;&#52;&#37;&#55;&#50;&#37;&#54;&#53;&#37;&#54;&#52;&#37;&#50;&#69;&#37;&#54;&#54;&#37;&#55;&#50;">&#109;&#105;&#108;&#100;&#114;&#101;&#100;&#45;&#112;&#117;&#98;&#45;&#49;&#64;&#109;&#105;&#108;&#100;&#114;&#101;&#100;&#46;&#102;&#114;</a>
      </p>
      <p>Mildred's Website: <a href="http://mildred.fr">http://mildred.fr</a>.
      I try to have <a href="http://www.w3.org/Provider/Style/URI">cools URI that don't change</a>.</p>
    </div>
  </body>
</html>
