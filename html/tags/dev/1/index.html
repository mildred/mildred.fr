<!DOCTYPE html>
<html>
  <head>
    <title>Category: dev - Mildred's Website</title>
    <meta charset='utf-8' />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type' />
    <meta content='' name='keywords' />
    <meta content='' name='description' />
    <meta content='initial-scale=1.0, width=device-width' name='viewport' />
    <meta content='tag' name='x-kind' />
    <link href='http://mildred.fr/tags/dev/1/' rel='canonical' />
    <link href='../../../favicon.png' rel='icon' type='image/png' />
    <link href='../../../favicon.png' rel='shortcut icon' type='image/png' />
    <link href='../../../style.css' media='screen' rel='stylesheet' type='text/css' />
    <link href='../atom.xml' rel='alternate' title='ATOM Feed' type='application/atom+xml' />
    <link href='../rss.xml' rel='alternate' title='RSS Feed' type='application/rss+xml' />
    <script src='../../../Scripts/json/json2.js' type='text/javascript'></script>
    <script src='../../../Scripts/jquery.min.js' type='text/javascript'></script>
    <script src='../../../Scripts/comments.js' type='text/javascript'></script>
    <script src='../../../Scripts/local.js' type='text/javascript'></script>
  </head>
  <body>
    <div class="header">
      <p class="access-links">
        <a href="#menu">Go to Menu</a>
        <br />
        <a href="#content">Go to Content</a>
      </p>
      <div class="left">
        <a href="../../../index.html">
          <img alt="My photo" class="photo" src="../../../Images/IMG_5669_square_128.jpeg"/>
        </a>
      </div>
      <div class="title">
        <h1>
          <a href="../../../index.html">Mildred's Website</a>
        </h1>
      </div>
      <div class="float-right"></div>
      <div class="clear-right"></div>
      <div class="right">
        <strong>Tags:</strong>
        <ul class="tags">
          <li>
            <a class="tag" href="../../cobra/index.html">cobra</a>
          </li>
          <li>
            <a class="tag" href="../../comp/index.html">comp</a>
          </li>
          <li>
            <a class="tag" href="../../configuration/index.html">configuration</a>
          </li>
          <li>
            <a class="tag" href="../index.html">dev</a>
          </li>
          <li>
            <a class="tag" href="../../dream/index.html">dream</a>
          </li>
          <li>
            <a class="tag" href="../../en/index.html">en</a>
          </li>
          <li>
            <a class="tag" href="../../fedora/index.html">fedora</a>
          </li>
          <li>
            <a class="tag" href="../../fr/index.html">fr</a>
          </li>
          <li>
            <a class="tag" href="../../freedombox/index.html">freedombox</a>
          </li>
          <li>
            <a class="tag" href="../../git/index.html">git</a>
          </li>
          <li>
            <a class="tag" href="../../html/index.html">html</a>
          </li>
          <li>
            <a class="tag" href="../../idea/index.html">idea</a>
          </li>
          <li>
            <a class="tag" href="../../liens/index.html">liens</a>
          </li>
          <li>
            <a class="tag" href="../../lisaac/index.html">lisaac</a>
          </li>
          <li>
            <a class="tag" href="../../lysaac/index.html">lysaac</a>
          </li>
          <li>
            <a class="tag" href="../../misc/index.html">misc</a>
          </li>
          <li>
            <a class="tag" href="../../photos/index.html">photos</a>
          </li>
          <li>
            <a class="tag" href="../../physics/index.html">physics</a>
          </li>
          <li>
            <a class="tag" href="../../politique/index.html">politique</a>
          </li>
          <li>
            <a class="tag" href="../../privacy/index.html">privacy</a>
          </li>
          <li>
            <a class="tag" href="../../srs/index.html">srs</a>
          </li>
          <li>
            <a class="tag" href="../../test/index.html">test</a>
          </li>
          <li>
            <a class="tag" href="../../web/index.html">web</a>
          </li>
          <li>
            <a class="tag" href="../../website/index.html">website</a>
          </li>
          <li>
            <a class="tag" href="../../wwwgen/index.html">wwwgen</a>
          </li>
          <li>
            <a class="tag" href="../../wwwsupport/index.html">wwwsupport</a>
          </li>
        </ul>
      </div>
      <div class="content">
        <div class="links" id="menu">
          <ul>
            <li>
              <a href="../../../index.html">Home</a>
            </li>
            <li>
              <a href="../../../Blog/index.html">Blog</a>
            </li>
            <li>
              <a href="//survie.mildred.fr">Survie</a>
            </li>
          </ul>
        </div>
      </div>
      <div class="clear"></div>
    </div>
    <div class="leftcol">
      <img alt="My avatar" class="photo" src="../../../Images/all128.jpeg"/>
      <hr/>
      <p>GoogleTalk, Jabber, XMPP address:
      <br /><strong><a href="xmpp:mildred&#64;jabber.fr">mildred&#64;jabber.fr</a></strong><!--&nbsp;<img src="http://presence.jabberfr.org/2dc519ffec76a836c2f2c2f66ac38291/image-dcraven.png" alt=""/><br /><em><script type="text/javascript" src="http://presence.jabberfr.org/2dc519ffec76a836c2f2c2f66ac38291/message_js.js"></script></em>-->
      </p>
      <hr/>
      <p>
        <a href="../../../gpg_key.txt">GPG Public Key</a>
        <br />
        <span style="font-size: 0.8em">
          (Fingerprint 197C A7E6 645B 4299 6D37 684B 6F9D A8D6 9A7D 2E2B)
        </span>
      </p>
    </div>
    <div class='main' id='content'>
      <h1>Category: dev</h1>
      <p>Articles from 1 to 10</p>
      <div class="article-list">
        <div class="sub-article">
          <h2>
            <a class="permalink" href="../../../Blog/2010/09/06/aliasing-strings-in-lisaac/index.html">Aliasing Strings in Lisaac</a>
          </h2>
          <div><p class='meta'>
  <span class='date-time'>
    <span class='date'>Mon 06 Sep 2010,</span>
    <span class='time'>09:13 AM</span>
  </span>
  <span class='tags'>
    <span class='tag'>
      <a class="tag" href="../../comp/index.html">comp</a>
    </span>
    <span class='tag'>
      <a class="tag" href="../index.html">dev</a>
    </span>
    <span class='tag'>
      <a class="tag" href="../../fr/index.html">fr</a>
    </span>
    <span class='tag'>
      <a class="tag" href="../../lisaac/index.html">lisaac</a>
    </span>
  </span>
</p>
<div class="excerpt">
  <p>En Lisaac, il y a trois types de chaînes de caractères: <code>ABSTRACT_STRING</code> qui
sert de parent à <code>STRING</code> et <code>STRING_CONSTANT</code>.</p>

<ul>
<li><p>Le prototype <code>ABSTRACT_STRING</code> contient les méthodes de bases pour toutes
les chaînes de caractères, utile à leur manipulation. C'est une <em>classe
abstraite</em> qui sert à la manipulation en lecture seule de toute chaîne de
caractères.</p></li>
<li><p><code>STRING</code> est un prototype qui introduit des méthodes de modification, comme
l'ajout d'une autre chaîne en fin. Il est très pratique en tant que buffer
pour construire une chaîne.</p></li>
<li><p>Vous l'aurez deviné, les <code>STRING_CONSTANT</code> sont des chaînes constantes qu'on
ne peux pas modifier (non mutables). Ce n'est pas techniquement impossible,
il vaut cependant mieux éviter. Ces <code>STRING_CONSTANT</code> correspondent en fait
aux chaînes littérales incluses dans le segment DATA de l'exécutable généré.
Ainsi, toutes ces chaînes sont obligatoirement terminées par <code>'\0'</code>
contrairement aux autres chaînes.</p>

<p>Une autre particularité est que les chaînes <code>STRING_CONSTANT</code> sont générées
par le compilateur, qui va s'assurer qu'il n'y aura pas deux chaînes
différentes compilées dans le programme avec le même contenu.</p></li>
</ul>


<p>Quelle conclusion peut on en tirer quant à la comparaison entre chaînes ?</p>

<ol>
<li><p>Il est nécessaire de comparer les chaînes caractère à caractère pour
s'assurer de leur égalité</p></li>
<li><p>Dans le cas des <code>STRING_CONSTANT</code>, il est possible de ne faire qu'une
comparaison de pointeurs.</p></li>
</ol>


<p>Bien sûr, la méthode n°2 est beaucoup plus rapide, Si possible, on aimerait
pouvoir l'utiliser tout le temps. Dans le cas du compilateur Lisaac, les
performances étant tellement critiques (nous avons affaire à un algorithme
exponentiel) que Benoît s'est arrangé pour toujours faire une comparaison de
pointeurs. Comment ?</p>

<p>Tout simplement en transformant les chaînes classiques en <code>STRING_CONSTANT</code>.
Cela est fait en construisant de toute pièces l'objet <code>STRING_CONSTANT</code> en
copiant les données contenues dans n'importe quelle autre chaîne. Et pour
s'assurer de l'unicité de la chaîne, il est nécesaire au préalable de vérifier
que la chaîne <code>STRING_CONSTANT</code> n'existe pas déjà.</p>

<p>Pour cela, toutes les chaînes utiles dans le compilateur à tout instant se
trouvent dans un prototype <code>ALIAS_STR</code>. Pour les utiliser, on fait juste
référence au nom du slot dans <code>ALIAS_STR</code>. Ces chaînes sont de plus insérées
au démarrage du compilateur dans l'ensemble <code>SET(ABSTRACT_STRING)</code> qui contient
toutes les chaînes constantes.</p>

<p>Cela reste une manipulation lourde (il est nécessaire d'insérer à la main toutes
les chaînes constantes qu'on utilise quelque part dans le compilateur dans cet
ensemble de chaînes) réservée au compilateur Lisaac. La conversion entre
<code>ABSTRACT_STRING</code> et <code>STRING_CONSTANT</code> reste explicite et alourdit le code. J'ai
eu donc envie de généraliser cela en l'implémentant en bibliothèque.</p>

<p>Avec les systèmes d'auto-import et auto-export, la conversion peut être très
facile. Il restait cependant le problème délicat de référencer toutes les
<code>STRING_CONSTANT</code> du segment DATA et de les insérer dans l'ensemble des chaînes.
Pour cela il faut ajouter un système d'introspection qui permet au programme de
parcourir toutes les chaînes constantes compilées. J'ai pensé à plusieurs
solutions:</p>

<ul>
<li><p>Ajouter trois externals pour respectivement avoir la borne basse du tableau
des chaînes compilées, la borne haute, et un moyen d'obtenir la chaîne à un
indice donné. Cela s'est avéré trop compliqué dans la mesure où les
externals sont évalués lors du depending pass et que les chaînes constantes
ne sont connues que lors de l'executong pass (voire à la toute fin de
l'exécution du compilateur).</p>

<p>Il aurait donc fallu ajouter une instruction pour évaluer la borne haute et
basse, et évaluer la <em>n</em><sup>ième</sup> chaîne. Puisque le paramètre est
tout sauf une constante entière, cela voudrait dire construire un bloc
conditionnel <code>SWITCH</code>. Trop complexe.</p></li>
<li><p>Seconde solution, fournir ldans deux externals le nombre de chaînes et un
pointeur vers un <code>NATIVE_ARRAY(STRING_CONSTANT)</code>. C'était la solution la
plus prometteuse, mais cela aurait complexifié la génération de code.</p>

<p>En effet, <code>NATIVE_ARRAY(STRING_CONSTANT)</code> se traduit en type C par
<code>STRING_CONSTANT**</code>. J'ai pensé au début que construire le code C suivant
suffirait:</p>

<pre><code>STRING_CONSTANT* __string = {&#x000A;  {12, "123456789012"},&#x000A;  ...&#x000A;  NULL&#x000A;};&#x000A;</code></pre>

<p>Sauf que cette construction est invalide en C, nous avons affaire à un
tableau de <code>Expanded STRING_CONSTANT</code>, et le marqueur <code>NULL</code> ne compile donc
pas en C. J'aurais donc pu créer le tableau à part, mais je n'avais pas
envie.</p>

<p>Ce qui aurait été possible:</p>

<pre><code>__STRING_CONSTANT __string_1 = {12, "123456789012"};&#x000A;...&#x000A;&#x000A;__STRING_CONSTANT* __string[] = {&#x000A;  __string_1,&#x000A;  ...&#x000A;  NULL&#x000A;};&#x000A;</code></pre></li>
<li><p>Dernière solution, la liste chaînée. Chaque chaîne est liée par un pointeur
à la chaîne précédante, et un unique external est généré pour avoir le haut
de la liste. Au final, cela ne prend pas plus de place qu'un tableau et
permet plus de possibilités (comme par exemple de faire rentrer dans la
liste des chaînes construites après coup). Le code C généré ressemble à:</p>

<pre><code>__STRING_CONSTANT __string_1 = {STRING_CONSTANT__, 12, "123456789012"};&#x000A;__STRING_CONSTANT __string_2 = {&amp;__string_1,       12, "123456789013"};&#x000A;__STRING_CONSTANT __string_3 = {&amp;__string_2,       12, "123456789014"};&#x000A;__STRING_CONSTANT* __string_first = &amp;__string_3;&#x000A;</code></pre>

<p>La première chaîne est liée au prototype (qui est lié à <code>NULL</code>) et les
chaînes suivantes sont liées à celles d'avant. Un symbole spécial représente
le haut de la pile qui est très simplement disponnible avec un external.
C'est la solution que j'ai retenue.</p></li>
</ul>


<p>Une fois le compilateur modifié, il faut modifier la bibliothèque standard. Au
début, j'ai eu pour approche d'utiliser la liste chaînée comme ensemble de
chaînes uniques au lieu d'un <code>HASHED_SET</code>. Mais les performances ont été
tellement déplorables que j'en suis revenu à l'ensemble de hash.</p>

<p>Les modifications sont presque prêtes, et il va être nécessaire d'introduire
deux commits de bootstrap (un commit pour introduire la fonctionnalité dans le
compilateur, l'autre avec une bibliothèque standard modifiée et le compilateur
qui délègue l'aliasing à la bibliothèque).</p>

<p>Il reste quelques problèmes à corriger, et ce sera prêt.</p>

<p>Mildred.</p>
</div></div>
          <div class="clear"></div>
        </div>
        <div class="sub-article">
          <h2>
            <a class="permalink" href="../../../Blog/2010/09/15/problemes-de-performance/index.html">Problèmes de Performance</a>
          </h2>
          <div><p class='meta'>
  <span class='date-time'>
    <span class='date'>Wed 15 Sep 2010,</span>
    <span class='time'>02:08 PM</span>
  </span>
  <span class='tags'>
    <span class='tag'>
      <a class="tag" href="../../comp/index.html">comp</a>
    </span>
    <span class='tag'>
      <a class="tag" href="../index.html">dev</a>
    </span>
    <span class='tag'>
      <a class="tag" href="../../fr/index.html">fr</a>
    </span>
    <span class='tag'>
      <a class="tag" href="../../lisaac/index.html">lisaac</a>
    </span>
  </span>
</p>
<div class="excerpt">
  <p>Ce post fait suite à mon <a href="/blog/2010/09/06/aliasing-strings-in-lisaac.html">précédent post sur l'aliasing des chaînes de
caractères</a>. Je disais que j'avais
presque fini, mais ce n'est sans doute pas le cas.</p>

<p>J'ai de gros problèmes de performance.</p>

<p>Rappelons ce que je cherche à faire :</p>

<ul>
<li>Ajouter une ou des primitives pour accéder aux <code>STRING_CONSTANT</code> compilées</li>
<li>Ajouter le support de l'aliasing des chaînes de caractères dans la
bibliothèque standard</li>
<li>Remplacer l'aliasing des chaînes du compilateur (<code>ALIAS_STR</code>) par l'aliasing
fait dans la bibliothèque standard.</li>
</ul>


<p>La première étape est réalisée grâce aux listes chaînées. Les primitives de
compilation ont été ajoutées.</p>

<p>La modification de la bibliothèque standard est bien avancée. Comme cela
nécessite une nouvelle primitive du compilateur, il à fallu bootstrapper le
compilateur à nouveau.</p>

<p>Et maintenant, vient la dernière étape: supprimer l'aliasing du compilateur.
Pour cela, je commence par me compiler un compilateur Lisaac avec <em>la nouvelle
primitive</em> et <em>son support dans la bibliothèque standard</em>. Ce compilateur est
<strong>extrêmement lent</strong> (2h45 de bootstrap). En effet, l'aliasing est réalisé en double. Puis je
supprime le support de l'aliasing du compilateur et j'ai un gros problème:</p>

<ul>
<li>le compilateur en mode optimisé plante</li>
<li>le compilateur en mode optimisé compilé avec gcc en mode debug ne plante pas</li>
<li>le compilateur en mode debug ne plante pas</li>
</ul>


<p>Je ne sais plus quoi faire ... et j'en suis là pour le moment. Je me demande si
c'est <code>-O2</code> ou <code>-fomit-frame-pointer</code> qui pose problème.</p>

<p><strong>Pour les problèmes d'optimisation,</strong> je pense savoir un peu ce qui cloche.
Voici comment j'ai implémenté l'aliasing dans <code>STRING_CONSTANT</code>:</p>

<pre><code>Section Public&#x000A;&#x000A;  - first_string :STRING_CONSTANT &lt;- (first_string := `100`);&#x000A;  // Il s'agit ici du pointeur de tête vers la liste chaînée au complet&#x000A;&#x000A;  + next_string :STRING_CONSTANT := NULL;&#x000A;  // Pointeur suivant de chaque STRING_CONSTANT vers la suivante (initialisé&#x000A;  // par le compilateur)&#x000A;&#x000A;Section Private&#x000A;&#x000A;  //&#x000A;  // Aliasing String.&#x000A;  //&#x000A;&#x000A;  - bucket:SET(ABSTRACT_STRING) &lt;-&#x000A;  // Ensemble de toutes les chaînes. HASHED_SET est tout de même bien plus&#x000A;  // performant qu'une liste chaînée non ordonnée.&#x000A;  ( + sc :STRING_CONSTANT;&#x000A;    bucket := HASHED_SET(ABSTRACT_STRING).create;&#x000A;&#x000A;    sc := first_string;&#x000A;    {(sc != STRING_CONSTANT) &amp;&amp; {sc != NULL}}.while_do {&#x000A;      bucket.fast_add sc;&#x000A;      sc := sc.next_string;&#x000A;    };&#x000A;&#x000A;    bucket&#x000A;  );&#x000A;&#x000A;  - list_insert &lt;-&#x000A;  // On met quand même à jour la liste chaînée, ça peut servir.&#x000A;  [&#x000A;    -? { first_string != Self };&#x000A;  ]&#x000A;  (&#x000A;    bucket.fast_add Self;&#x000A;    next_string  := first_string;&#x000A;    first_string := Self;&#x000A;  );&#x000A;&#x000A;Section Public&#x000A;&#x000A;  - new_intern p:NATIVE_ARRAY(CHARACTER) count nb_char:INTEGER :SELF&lt;-&#x000A;  // Do not use directly. WARNING: Use by c_string and c_argument (COMMAND_LINE).&#x000A;  ( + sc, result:STRING_CONSTANT;&#x000A;&#x000A;    sc := clone;&#x000A;    sc.set_storage p count nb_char;&#x000A;    result ?= bucket.reference_at sc;&#x000A;    (result = NULL).if {&#x000A;      result := sc;&#x000A;      result.list_insert;&#x000A;    };&#x000A;&#x000A;    result&#x000A;  );&#x000A;</code></pre>

<p>En fait, j'ai pas du tout assuré !!!</p>

<p>J'ai deux slots code (<code>&lt;-</code>) qui sont réinitialisés en données (<code>:=</code>). Cela veut
dire qu'à chaque fois que le slot est appelé, le compilateur va intéroger un
slot invisible auto-généré pour savoir si c'est la donnée qu'on veut ou le code.</p>

<p>En plus j'ai l'impression que la version de Lisaac que j'utilise pour compiler
(celle qui met 2h45) avait peut être une ancienne version de la lib ou
l'aliasing était fait par la liste chaînée non triée au lieu de <code>HASHED_SET</code>.
Bref, j'ai tout à revoir.</p>

<p>Mildred</p>
</div></div>
          <div class="clear"></div>
        </div>
        <div class="sub-article">
          <h2>
            <a class="permalink" href="../../../Blog/2011/04/12/lysaac_and_clusters/index.html">Lysaac and clusters</a>
          </h2>
          <div><p class='meta'>
  <span class='date-time'>
    <span class='date'>Tue 12 Apr 2011,</span>
    <span class='time'>04:35 PM</span>
  </span>
  <span class='tags'>
    <span class='tag'>
      <a class="tag" href="../../comp/index.html">comp</a>
    </span>
    <span class='tag'>
      <a class="tag" href="../index.html">dev</a>
    </span>
    <span class='tag'>
      <a class="tag" href="../../en/index.html">en</a>
    </span>
    <span class='tag'>
      <a class="tag" href="../../lisaac/index.html">lisaac</a>
    </span>
    <span class='tag'>
      <a class="tag" href="../../lysaac/index.html">lysaac</a>
    </span>
  </span>
</p>
<div class="excerpt">
  <p>If you noticed, I started my own Lisaac compiler, called <a href="http://github.com/mildred/lysaac">Lysaac</a> and I want
to make it a little bit different from Lisaac. I'll try to keep compatibility,
but for few things, I might take a different direction.</p>

<p>One of these things is the way prototypes are found.</p>

<p>In Lisaac, you have a complete set of prototypes and when you look for a
prototype, it is looked everywhere. This is not desirable. Imagine you are
writing a library that requires the prototype <code>FOO</code>. Currently, if <code>FOO</code> is not
present in the library, instead of issuing an error, the compiler would take the
<code>FOO</code> prototype in the application that use the library. Meaning that the
library is effectvely using a pieve of the application code.</p>

<p>I want to take the SmartEiffel approach and separate the source code in few
clusters. A cluster is a collection of prototypes. And the prototypes in a
cluster can only use the prototype of the same cluster or the prototypes of
imported clusters. This solve the above dependancy problem.</p>

<p>A cluster is a directory that contain prototypes in <code>.li</code> files and
subdirectories. If a subdirectory do not contain <code>.li</code> files, the
sub-subdirectories are not recursively searched. A cluster can import another
cluster using a cluster file ending with <code>.cli</code>.</p>

<p>An example of <code>.cli</code> file is as follows:</p>

<pre><code>Section Header&#x000A;&#x000A;  - name := Cluster LIBFOO;&#x000A;&#x000A;  - path := ("libfoo-3.14", "../libfoo");&#x000A;</code></pre>

<p>The search paths can be:</p>

<ul>
<li>relative to the <code>.cli</code> file if it starts with <code>.</code></li>
<li>relative to <code>LYSAAC_PATH</code> directories otherwise</li>
</ul>


<p><code>LISAAC_PATH</code> defaults to <code>$XDG_DATA_HOME/lysaac/lib:/usr/local/share/lysaac/lib:/usr/share/lysaac/lib</code>.</p>

<p>The search paths would then be for this example:</p>

<ul>
<li><code>$XDG_DATA_HOME/lysaac/lib/libfoo-3.14</code></li>
<li><code>/usr/local/share/lysaac/lib/libfoo-3.14</code></li>
<li><code>/usr/share/lysaac/lib/libfoo-3.14</code></li>
<li><code>../libfoo</code></li>
</ul>


<p>The parser for these files is being written. Then you can see the complete
hierarchy of the project:</p>

<pre><code>$ lysaac src&#x000A;◆ Root Cluster&#x000A;│ Cluster in: src&#x000A;├─◆ LIB (src/lib.cli)&#x000A;│ │ Cluster in: lib&#x000A;│ ├─◆ STDLIB (lib/stdlib.cli)&#x000A;│ │ │ Cluster in: /home/mildred/.local/share/lysaac/lib/stdlib&#x000A;│ │ ├─◇ STRING (...)&#x000A;│ │ ├─◇ ABSTRACT_STRING (...)&#x000A;│ │ ╰─◇ ...&#x000A;│ ├─◇ LIBC (lib/libc.li)&#x000A;│ ╰─◇ CSTRING (lib/cstring.li)&#x000A;├─◇ PARSER (src/parser.li)&#x000A;├─◇ CLUSTER_ITEM (src/cluster_item.li)&#x000A;├─◇ ITM_STYLE (src/itm_style.li)&#x000A;├─◇ LYSAAC (src/lysaac.li)&#x000A;├─◇ ITM_AFFECT (src/itm_affect.li)&#x000A;├─◇ ANY (src/any.li)&#x000A;├─◇ PARSER_CLI (src/parser_cli.li)&#x000A;╰─◇ CLUSTER (src/cluster.li)&#x000A;</code></pre>

<p>Now, each item in a cluster can be public or private. Public items are available
to the users of the clusters whereas private items are restricted to members of
the same cluster. To declare a private item, just say:</p>

<pre><code>Section Header&#x000A;&#x000A;  + name := Private PROTOTYPE;&#x000A;</code></pre>

<p>or</p>

<pre><code>Section Header&#x000A;&#x000A;  - name := Private Cluster LIBTOTO;&#x000A;</code></pre>

<p>If you want to declare a whole bunch of prototypes private to your cluster, just
include them in a private cluster. To do so, you'll need the following files:</p>

<ul>
<li><p>cluster/my_private_prototypes.cli:</p>

<pre><code>Section Header&#x000A;&#x000A;  - name := Private Cluster MY_PRIVATE_PROTOTYPES;&#x000A;&#x000A;  - path := "./deps/my_private_prototypes";&#x000A;  // makes the cluster relative to the .cli file&#x000A;  // use a deps additional directory to avoid the current cluster to&#x000A;  // look into deps/my_private_prototypes. deps should not contain any&#x000A;  // files, just subdirectories.&#x000A;</code></pre></li>
<li><p>cluster/deps/my_private_prototypes/private_proto.li:</p>

<pre><code>Section Header&#x000A;&#x000A;  + name := Public Prototype PRIVATE_PROTO;&#x000A;</code></pre></li>
</ul>
</div></div>
          <div class="clear"></div>
        </div>
        <div class="sub-article">
          <h2>
            <a class="permalink" href="../../../Blog/2011/04/20/clusters_in_lysaac_works/index.html">Clusters in Lysaac works</a>
          </h2>
          <div><p class='meta'>
  <span class='date-time'>
    <span class='date'>Wed 20 Apr 2011,</span>
    <span class='time'>11:17 AM</span>
  </span>
  <span class='tags'>
    <span class='tag'>
      <a class="tag" href="../../comp/index.html">comp</a>
    </span>
    <span class='tag'>
      <a class="tag" href="../index.html">dev</a>
    </span>
    <span class='tag'>
      <a class="tag" href="../../lysaac/index.html">lysaac</a>
    </span>
  </span>
</p>
<div class="excerpt">
  

<pre>&#x000A;◆ Root Cluster&#x000A;│ Cluster in: src&#x000A;├─◆ LIB (src/lib.cli)&#x000A;│ │ Cluster in: src/../lib&#x000A;│ ├─◇ PATH_HELPER (src/../lib/path_helper.li)&#x000A;│ ├─◇ CSTRING (src/../lib/cstring.li)&#x000A;│ ╰─◇ LIBC (src/../lib/libc.li)&#x000A;├─◇ PARSER (src/parser.li)&#x000A;├─◆ STDLIB (src/stdlib.cli)&#x000A;│ │ Cluster in: src/../stdlib/standard&#x000A;│ ├─◆ INTERNAL (src/../stdlib/standard/internal.cli)&#x000A;│ │ │ Cluster in: src/../stdlib/standard/../internal&#x000A;│ │ ├─◆ PORTABLE (src/../stdlib/standard/../internal/portable.cli)&#x000A;│ │ │ │ Cluster in: src/../stdlib/standard/../internal/portable&#x000A;│ │ │ ├─◇ FLOAT_REAL (src/../stdlib/standard/../internal/portable/number/float_real.li)&#x000A;│ │ │ ├─◇ FIXED_REAL (src/../stdlib/standard/../internal/portable/number/fixed_real.li)&#x000A;│ │ │ ├─◇ FLOAT_MAP80 (src/../stdlib/standard/../internal/portable/number/float_map80.li)&#x000A;│ │ │ ├─◇ SIGNED_INTEGER (src/../stdlib/standard/../internal/portable/number/signed_integer.li)&#x000A;│ │ │ ├─◇ FLOAT_MAP32 (src/../stdlib/standard/../internal/portable/number/float_map32.li)&#x000A;│ │ │ ├─◇ UNSIGNED_INTEGER (src/../stdlib/standard/../internal/portable/number/unsigned_integer.li)&#x000A;│ │ │ ├─◇ FLOAT_MAP64 (src/../stdlib/standard/../internal/portable/number/float_map64.li)&#x000A;│ │ │ ├─◇ SIGNED_FIXED_REAL (src/../stdlib/standard/../internal/portable/number/signed_fixed_real.li)&#x000A;│ │ │ ├─◇ NUMERIC (src/../stdlib/standard/../internal/portable/number/numeric.li)&#x000A;│ │ │ ├─◇ FLOAT_MAP (src/../stdlib/standard/../internal/portable/number/float_map.li)&#x000A;│ │ │ ├─◇ UNSIGNED_FIXED_REAL (src/../stdlib/standard/../internal/portable/number/unsigned_fixed_real.li)&#x000A;│ │ │ ├─◇ FILE_INPUT_STREAM (src/../stdlib/standard/../internal/portable/io/file_input_stream.li)&#x000A;│ │ │ ├─◇ STD_INPUT_OUTPUT (src/../stdlib/standard/../internal/portable/io/std_input_output.li)&#x000A;│ │ │ ├─◇ FILE_OUTPUT_STREAM (src/../stdlib/standard/../internal/portable/io/file_output_stream.li)&#x000A;│ │ │ ├─◇ INPUT_STREAM (src/../stdlib/standard/../internal/portable/io/input_stream.li)&#x000A;│ │ │ ├─◇ OUTPUT_STREAM (src/../stdlib/standard/../internal/portable/io/output_stream.li)&#x000A;│ │ │ ├─◇ MEMORY (src/../stdlib/standard/../internal/portable/memory/memory.li)&#x000A;│ │ │ ├─◇ SYSTEM_DETECT (src/../stdlib/standard/../internal/portable/system/system_detect.li)&#x000A;│ │ │ ├─◇ HASHED_DICTIONARY_NODE (src/../stdlib/standard/../internal/portable/collection/hashed_dictionary_node.li)&#x000A;│ │ │ ├─◇ COLLECTION (src/../stdlib/standard/../internal/portable/collection/collection.li)&#x000A;│ │ │ ├─◇ HASH_TABLE_SIZE (src/../stdlib/standard/../internal/portable/collection/hash_table_size.li)&#x000A;│ │ │ ├─◇ ANY_HASHED_BIJECTIVE_DICTIONARY_NODE (src/../stdlib/standard/../internal/portable/collection/any_hashed_bijective_dictionary_node.li)&#x000A;│ │ │ ├─◇ ANY_LINKED_LIST_NODE (src/../stdlib/standard/../internal/portable/collection/any_linked_list_node.li)&#x000A;│ │ │ ├─◇ ANY_AVL_SET_NODE (src/../stdlib/standard/../internal/portable/collection/any_avl_set_node.li)&#x000A;│ │ │ ├─◇ LINKED2_LIST_NODE (src/../stdlib/standard/../internal/portable/collection/linked2_list_node.li)&#x000A;│ │ │ ├─◇ ANY_AVL_DICTIONARY_NODE (src/../stdlib/standard/../internal/portable/collection/any_avl_dictionary_node.li)&#x000A;│ │ │ ├─◇ COLLECTION3 (src/../stdlib/standard/../internal/portable/collection/collection3.li)&#x000A;│ │ │ ├─◇ SET (src/../stdlib/standard/../internal/portable/collection/set.li)&#x000A;│ │ │ ├─◇ ANY_TWO_WAY_LINKED_LIST_NODE (src/../stdlib/standard/../internal/portable/collection/any_two_way_linked_list_node.li)&#x000A;│ │ │ ├─◇ HASHED_SET_NODE (src/../stdlib/standard/../internal/portable/collection/hashed_set_node.li)&#x000A;│ │ │ ├─◇ ARRAYED_COLLECTION (src/../stdlib/standard/../internal/portable/collection/arrayed_collection.li)&#x000A;│ │ │ ├─◇ SIMPLE_DICTIONARY (src/../stdlib/standard/../internal/portable/collection/simple_dictionary.li)&#x000A;│ │ │ ├─◇ DICTIONARY (src/../stdlib/standard/../internal/portable/collection/dictionary.li)&#x000A;│ │ │ ├─◇ AVL_DICTIONARY_NODE (src/../stdlib/standard/../internal/portable/collection/avl_dictionary_node.li)&#x000A;│ │ │ ├─◇ AVL_CONSTANTS (src/../stdlib/standard/../internal/portable/collection/avl_constants.li)&#x000A;│ │ │ ├─◇ ANY_HASHED_SET_NODE (src/../stdlib/standard/../internal/portable/collection/any_hashed_set_node.li)&#x000A;│ │ │ ├─◇ NATIVE_ARRAY (src/../stdlib/standard/../internal/portable/collection/native_array.li)&#x000A;│ │ │ ├─◇ AVL_TREE (src/../stdlib/standard/../internal/portable/collection/avl_tree.li)&#x000A;│ │ │ ├─◇ NATIVE_ARRAY_VOLATILE (src/../stdlib/standard/../internal/portable/collection/native_array_volatile.li)&#x000A;│ │ │ ├─◇ COLLECTION2 (src/../stdlib/standard/../internal/portable/collection/collection2.li)&#x000A;│ │ │ ├─◇ ANY_HASHED_DICTIONARY_NODE (src/../stdlib/standard/../internal/portable/collection/any_hashed_dictionary_node.li)&#x000A;│ │ │ ├─◇ ARRAYED (src/../stdlib/standard/../internal/portable/collection/arrayed.li)&#x000A;│ │ │ ├─◇ AVL_SET_NODE (src/../stdlib/standard/../internal/portable/collection/avl_set_node.li)&#x000A;│ │ │ ├─◇ LINKED_XOR_NODE (src/../stdlib/standard/../internal/portable/collection/linked_xor_node.li)&#x000A;│ │ │ ├─◇ LINKED_LIST_NODE (src/../stdlib/standard/../internal/portable/collection/linked_list_node.li)&#x000A;│ │ │ ├─◇ AVL_TREE_NODE (src/../stdlib/standard/../internal/portable/collection/avl_tree_node.li)&#x000A;│ │ │ ├─◇ LINKED_COLLECTION (src/../stdlib/standard/../internal/portable/collection/linked_collection.li)&#x000A;│ │ │ ├─◇ FS_MIN (src/../stdlib/standard/../internal/portable/file_system/fs_min.li)&#x000A;│ │ │ ├─◇ STRING_BUFFER (src/../stdlib/standard/../internal/portable/string/string_buffer.li)&#x000A;│ │ │ ╰─◇ CHARACTER_REF (src/../stdlib/standard/../internal/portable/string/character_ref.li)&#x000A;│ │ ╰─◆ UNIX (src/../stdlib/standard/../internal/unix.cli)&#x000A;│ │   │ Cluster in: src/../stdlib/standard/../internal/os_support/unix&#x000A;│ │   ├─◇ FLOAT_PROCESSOR (src/../stdlib/standard/../internal/os_support/unix/system/float_processor.li)&#x000A;│ │   ├─◇ SYSTEM (src/../stdlib/standard/../internal/os_support/unix/system/system.li)&#x000A;│ │   ├─◇ CLOCK (src/../stdlib/standard/../internal/os_support/unix/system/clock.li)&#x000A;│ │   ├─◇ ENVIRONMENT (src/../stdlib/standard/../internal/os_support/unix/system/environment.li)&#x000A;│ │   ├─◇ SYSTEM_IO (src/../stdlib/standard/../internal/os_support/unix/system/system_io.li)&#x000A;│ │   ├─◇ PROCESSOR (src/../stdlib/standard/../internal/os_support/unix/system/processor.li)&#x000A;│ │   ├─◇ EVENT_SYSTEM (src/../stdlib/standard/../internal/os_support/unix/video/event_system.li)&#x000A;│ │   ├─◇ KEYBOARD (src/../stdlib/standard/../internal/os_support/unix/video/keyboard.li)&#x000A;│ │   ├─◇ TIMER (src/../stdlib/standard/../internal/os_support/unix/video/timer.li)&#x000A;│ │   ├─◇ VIDEO (src/../stdlib/standard/../internal/os_support/unix/video/video.li)&#x000A;│ │   ├─◇ MOUSE (src/../stdlib/standard/../internal/os_support/unix/video/mouse.li)&#x000A;│ │   ├─◇ FILE_UNIX (src/../stdlib/standard/../internal/os_support/unix/file_system/file_unix.li)&#x000A;│ │   ├─◇ FILE_SYSTEM (src/../stdlib/standard/../internal/os_support/unix/file_system/file_system.li)&#x000A;│ │   ├─◇ ENTRY_UNIX (src/../stdlib/standard/../internal/os_support/unix/file_system/entry_unix.li)&#x000A;│ │   ├─◇ DIRECTORY_UNIX (src/../stdlib/standard/../internal/os_support/unix/file_system/directory_unix.li)&#x000A;│ │   ├─◇ BMP_LINE_ASCII (src/../stdlib/standard/../internal/os_support/unix/video_ascii/bmp_line_ascii.li)&#x000A;│ │   ├─◇ BITMAP_ASCII (src/../stdlib/standard/../internal/os_support/unix/video_ascii/bitmap_ascii.li)&#x000A;│ │   ├─◇ VIDEO (src/../stdlib/standard/../internal/os_support/unix/video_ascii/video.li)&#x000A;│ │   ╰─◇ PIXEL_ASCII (src/../stdlib/standard/../internal/os_support/unix/video_ascii/pixel_ascii.li)&#x000A;│ ├─◇ STD_ERROR (src/../stdlib/standard/io/std_error.li)&#x000A;│ ├─◇ COMMAND_LINE (src/../stdlib/standard/io/command_line.li)&#x000A;│ ├─◇ IO (src/../stdlib/standard/io/io.li)&#x000A;│ ├─◇ STD_INPUT (src/../stdlib/standard/io/std_input.li)&#x000A;│ ├─◇ STD_OUTPUT (src/../stdlib/standard/io/std_output.li)&#x000A;│ ├─◇ TIME (src/../stdlib/standard/time/time.li)&#x000A;│ ├─◇ DATE (src/../stdlib/standard/time/date.li)&#x000A;│ ├─◇ HASHABLE (src/../stdlib/standard/property/hashable.li)&#x000A;│ ├─◇ COMPARABLE (src/../stdlib/standard/property/comparable.li)&#x000A;│ ├─◇ SAFE_EQUAL (src/../stdlib/standard/property/safe_equal.li)&#x000A;│ ├─◇ TRAVERSABLE (src/../stdlib/standard/property/traversable.li)&#x000A;│ ├─◇ OBJECT (src/../stdlib/standard/kernel/object.li)&#x000A;│ ├─◇ I_DONT_KNOW_PROTOTYPING (src/../stdlib/standard/kernel/i_dont_know_prototyping.li)&#x000A;│ ├─◇ POINTER (src/../stdlib/standard/kernel/pointer.li)&#x000A;│ ├─◇ CONVERT (src/../stdlib/standard/kernel/convert.li)&#x000A;│ ├─◇ REFERENCE (src/../stdlib/standard/kernel/reference.li)&#x000A;│ ├─◇ BLOCK (src/../stdlib/standard/kernel/block.li)&#x000A;│ ├─◇ HASHED_DICTIONARY (src/../stdlib/standard/collection/hashed_dictionary.li)&#x000A;│ ├─◇ ARRAY2 (src/../stdlib/standard/collection/array2.li)&#x000A;│ ├─◇ AVL_SET (src/../stdlib/standard/collection/avl_set.li)&#x000A;│ ├─◇ LINKED2_LIST (src/../stdlib/standard/collection/linked2_list.li)&#x000A;│ ├─◇ ARRAY3 (src/../stdlib/standard/collection/array3.li)&#x000A;│ ├─◇ ARRAY (src/../stdlib/standard/collection/array.li)&#x000A;│ ├─◇ ITERATOR (src/../stdlib/standard/collection/iterator.li)&#x000A;│ ├─◇ FAST_ARRAY3 (src/../stdlib/standard/collection/fast_array3.li)&#x000A;│ ├─◇ LINKED_XOR_LIST (src/../stdlib/standard/collection/linked_xor_list.li)&#x000A;│ ├─◇ LINKED_LIST (src/../stdlib/standard/collection/linked_list.li)&#x000A;│ ├─◇ HASHED_SET (src/../stdlib/standard/collection/hashed_set.li)&#x000A;│ ├─◇ FAST_ARRAY2 (src/../stdlib/standard/collection/fast_array2.li)&#x000A;│ ├─◇ FAST_ARRAY (src/../stdlib/standard/collection/fast_array.li)&#x000A;│ ├─◇ AVL_DICTIONARY (src/../stdlib/standard/collection/avl_dictionary.li)&#x000A;│ ├─◇ STD_FILE (src/../stdlib/standard/file_system/std_file.li)&#x000A;│ ├─◇ DIRECTORY (src/../stdlib/standard/file_system/directory.li)&#x000A;│ ├─◇ ENTRY (src/../stdlib/standard/file_system/entry.li)&#x000A;│ ├─◇ FILE (src/../stdlib/standard/file_system/file.li)&#x000A;│ ├─◇ HTTP_SERVER (src/../stdlib/standard/http/http_server.li)&#x000A;│ ├─◇ HTTP_HEADER (src/../stdlib/standard/http/http_header.li)&#x000A;│ ├─◇ FALSE (src/../stdlib/standard/boolean/false.li)&#x000A;│ ├─◇ BOOLEAN (src/../stdlib/standard/boolean/boolean.li)&#x000A;│ ├─◇ TRUE (src/../stdlib/standard/boolean/true.li)&#x000A;│ ├─◇ STRING_CONSTANT (src/../stdlib/standard/string/string_constant.li)&#x000A;│ ├─◇ STRING (src/../stdlib/standard/string/string.li)&#x000A;│ ├─◇ ABSTRACT_STRING (src/../stdlib/standard/string/abstract_string.li)&#x000A;│ ╰─◇ CHARACTER (src/../stdlib/standard/string/character.li)&#x000A;├─◇ CLUSTER_ITEM (src/cluster_item.li)&#x000A;├─◇ ITM_STYLE (src/itm_style.li)&#x000A;├─◇ LYSAAC (src/lysaac.li)&#x000A;├─◇ ITM_AFFECT (src/itm_affect.li)&#x000A;├─◇ ANY (src/any.li)&#x000A;├─◇ PARSER_CLI (src/parser_cli.li)&#x000A;╰─◇ CLUSTER (src/cluster.li)</pre>
</div></div>
          <div class="clear"></div>
        </div>
        <div class="sub-article">
          <h2>
            <a class="permalink" href="../../../Blog/2011/04/29/lysaac_compilation_model_and_inline_prototypes/index.html">Lysaac compilation model and inline prototypes</a>
          </h2>
          <div><p class='meta'>
  <span class='date-time'>
    <span class='date'>Fri 29 Apr 2011,</span>
    <span class='time'>09:19 AM</span>
  </span>
  <span class='tags'>
    <span class='tag'>
      <a class="tag" href="../../comp/index.html">comp</a>
    </span>
    <span class='tag'>
      <a class="tag" href="../index.html">dev</a>
    </span>
    <span class='tag'>
      <a class="tag" href="../../en/index.html">en</a>
    </span>
    <span class='tag'>
      <a class="tag" href="../../lisaac/index.html">lisaac</a>
    </span>
    <span class='tag'>
      <a class="tag" href="../../lysaac/index.html">lysaac</a>
    </span>
  </span>
</p>
<div class="excerpt">
  <p>In Lysaac, I choose to follow the open world assumption, like the majority of
programming languages out there, instead of the closed world assumption. There
are two main reasons:</p>

<ul>
<li><p>First, I don't strive at creating an optimizing compiler, not yet at least.
Closed world is useful for that, but I don't need it.</p></li>
<li><p>Second, open world assumption increases the complexity a lot. The Lisaac
compiler uses an exponential algorithm, and will always hit a limit with
big projects. With an open world, you can partition the complexity.</p></li>
</ul>


<p>Because I still believe in global compilation, I decided that my compilation
unit would be the cluster instead of the prototype. That is, I'll compile a
cluster completely in one object file. That makes it possible to optimize things
like private prototypes.</p>

<p>This leaves a big performance problem for <code>BOOLEAN</code>s in particular. <code>BOOLEAN</code>,
<code>TRUE</code> and <code>FALSE</code> are prototypes in the standard library, and having an open
world assumption would require pasing to the <code>if then</code> slot function pointers.
I can't realisticly do that.</p>

<p>So, These prototypes could be marked as <code>Inline</code>. They are separated from their
cluster and gets compiled in every cluster that uses them. The syntax could be
quite simple:</p>

<pre><code>Section Header&#x000A;&#x000A;  + name := Inline TRUE;&#x000A;</code></pre>

<p>But, because each cluster is then free to compile it as it wants, there is a
problem of interoperability. How can you be sure that the <code>TRUE</code> in your cluster
is compiled the same way as in the neighbooring cluster you are using. As it is,
you can't pass <code>TRUE</code> object around clusters. Very annoying.</p>

<p>The solution would be to encode them and decode them manually. You could have:</p>

<pre><code>Section Header&#x000A;&#x000A;  + name := Inline TRUE;&#x000A;&#x000A;Section Feature&#x000A;&#x000A;  - inline_size :INTEGER := 0;&#x000A;</code></pre>

<p>Take a more interesting example:</p>

<pre><code>Section Header&#x000A;&#x000A;  + name := Inline Expanded BIT;&#x000A;&#x000A;  - size := 1;&#x000A;&#x000A;Section Feature&#x000A;&#x000A;  - inline_size :INTEGER := 1;&#x000A;  - encode p:POINTER &lt;-&#x000A;  (&#x000A;    p.to_native_array_of BIT.put bit to 0;&#x000A;  );&#x000A;  - decode p:POINTER &lt;-&#x000A;  (&#x000A;    data := p.to_native_array_of BIT.item 0;&#x000A;  );&#x000A;</code></pre>

<p>This needs to be refined.</p>

<p>Additionally, <code>.cli</code> files could also contain the <code>Inline</code> keyword. In that
case, the cluster it reference will be compiled with the current cluster. That
could be useful for private clusters.</p>
</div></div>
          <div class="clear"></div>
        </div>
        <div class="sub-article">
          <h2>
            <a class="permalink" href="../../../Blog/2011/04/29/lysaac_annotations/index.html">Lysaac annotations</a>
          </h2>
          <div><p class='meta'>
  <span class='date-time'>
    <span class='date'>Fri 29 Apr 2011,</span>
    <span class='time'>09:40 AM</span>
  </span>
  <span class='tags'>
    <span class='tag'>
      <a class="tag" href="../../comp/index.html">comp</a>
    </span>
    <span class='tag'>
      <a class="tag" href="../index.html">dev</a>
    </span>
    <span class='tag'>
      <a class="tag" href="../../en/index.html">en</a>
    </span>
    <span class='tag'>
      <a class="tag" href="../../lisaac/index.html">lisaac</a>
    </span>
    <span class='tag'>
      <a class="tag" href="../../lysaac/index.html">lysaac</a>
    </span>
  </span>
</p>
<div class="excerpt">
  <p>Because I'm using an open world assumption, I need the compiler to generate
annotations on units it compiles, so when it sees them again, it knows what it
does (or does not) internally.</p>

<p>I was looking at <a href="http://www.youtube.com/watch?v=ryfw9_-Hnb0">a LLVM video</a> this morning (VMKit precisely) and the
person talked about an interesting optimization. What if we could allocate
objects in stack instead of the heap. This would save time when creating the
object. Then we wouldn't be tempted to avoid creating new objects for fear of
memory leaks (there is not garbage collector in lisaac currently) and
performance penalty.</p>

<p>This is the same thing as aliased variables in Ada.</p>

<p>An object can be allocated on the stack if:</p>

<ul>
<li>it is not returned by the function.</li>
<li>it is not stored on the heap by the function.</li>
<li>it is not used in a called function that would store a pointer to this
object on the heap.</li>
</ul>


<p>So, when the compiler compiles a cluster, it has to generate an annotation file
containing for each argument in each code slot whether the argument is
guaranteed to remain on the stack or if it might be stored on the heap. If an
argument is guaranteed to stay on the stack, we can allocate it on the stack.
When the function will return, the only instances would be located in the
current stack frame.</p>
</div></div>
          <div class="clear"></div>
        </div>
        <div class="sub-article">
          <h2>
            <a class="permalink" href="../../../Blog/2011/04/29/stack_environments/index.html">Stack environments</a>
          </h2>
          <div><p class='meta'>
  <span class='date-time'>
    <span class='date'>Fri 29 Apr 2011,</span>
    <span class='time'>09:52 AM</span>
  </span>
  <span class='tags'>
    <span class='tag'>
      <a class="tag" href="../../comp/index.html">comp</a>
    </span>
    <span class='tag'>
      <a class="tag" href="../index.html">dev</a>
    </span>
    <span class='tag'>
      <a class="tag" href="../../en/index.html">en</a>
    </span>
    <span class='tag'>
      <a class="tag" href="../../lisaac/index.html">lisaac</a>
    </span>
    <span class='tag'>
      <a class="tag" href="../../lysaac/index.html">lysaac</a>
    </span>
  </span>
</p>
<div class="excerpt">
  <p>Stack environment would be an argument passed implicitely to every function in
the code. It would contain global policy. In particular the <code>MEMORY</code> object that
lets you allocate memory. If you want to change the allocation policy, you just
have to change the current environment, and all functions you call will use the
new policy.</p>

<p>We could allow user defined objects like that, not just system objects.</p>

<p>We could also manage errors that way. An error flag could be stored in the
environment. Set by the calee and tested by the caller.</p>
</div></div>
          <div class="clear"></div>
        </div>
        <div class="sub-article">
          <h2>
            <a class="permalink" href="../../../Blog/2011/04/29/union_types_and_null/index.html">Union types and null</a>
          </h2>
          <div><p class='meta'>
  <span class='date-time'>
    <span class='date'>Fri 29 Apr 2011,</span>
    <span class='time'>09:56 AM</span>
  </span>
  <span class='tags'>
    <span class='tag'>
      <a class="tag" href="../../comp/index.html">comp</a>
    </span>
    <span class='tag'>
      <a class="tag" href="../index.html">dev</a>
    </span>
    <span class='tag'>
      <a class="tag" href="../../lisaac/index.html">lisaac</a>
    </span>
    <span class='tag'>
      <a class="tag" href="../../lysaac/index.html">lysaac</a>
    </span>
  </span>
</p>
<div class="excerpt">
  <p>Look at this:</p>

<p><code>object.li</code></p>

<pre><code>Section Header&#x000A;&#x000A;  + name := Singleton NULL;&#x000A;&#x000A;Section Public&#x000A;&#x000A;  - is_null :BOOLEAN &lt;- FALSE;&#x000A;</code></pre>

<p><code>null.li</code></p>

<pre><code>Section Header&#x000A;&#x000A;  + name := Singleton NULL;&#x000A;&#x000A;Section Inherit&#x000A;&#x000A;  - parent :OBJECT := OBJECT;&#x000A;&#x000A;Section Public&#x000A;&#x000A;  - is_null :BOOLEAN &lt;- TRUE;&#x000A;</code></pre>

<p><code>union.li</code></p>

<pre><code>Section Header&#x000A;&#x000A;  + name := UNION;&#x000A;&#x000A;Section Inherit&#x000A;&#x000A;  - parent :OBJECT := OBJECT;&#x000A;</code></pre>

<p><code>union.1.li</code></p>

<pre><code>Section Header&#x000A;&#x000A;  + name := Expanded UNION(E);&#x000A;&#x000A;  - import := E;&#x000A;&#x000A;Section Inherit&#x000A;&#x000A;  - parent :UNION := UNION;&#x000A;&#x000A;Section Public&#x000A;&#x000A;  + element:E;&#x000A;  - set_element e:E &lt;- (element := e;);&#x000A;&#x000A;  - when o:T do blc:{o:T;} &lt;-&#x000A;  (&#x000A;    (o = E).if {&#x000A;      blc.value element;&#x000A;    };&#x000A;  );&#x000A;&#x000A;  - from_e e:E :SELF &lt;-&#x000A;  ( + res :SELF;&#x000A;    res := clone;&#x000A;    res.set_element e;&#x000A;    res&#x000A;  );&#x000A;</code></pre>

<p><code>union.2.li</code></p>

<pre><code>Section Header&#x000A;&#x000A;  + name := Expanded UNION(E, F...);&#x000A;&#x000A;Section Inherit&#x000A;&#x000A;  + parent_e :UNION(E);&#x000A;  + parent_next :UNION(F...);&#x000A;&#x000A;Section Public&#x000A;&#x000A;  - when o:T do blc:{o:T;} &lt;-&#x000A;  (&#x000A;    (o = E).if {&#x000A;      parent_e.when o do blc;&#x000A;    } else {&#x000A;      parent_next.when o do blc;&#x000A;    };&#x000A;  );&#x000A;</code></pre>

<p><code>use.li</code></p>

<pre><code>Section Header&#x000A;&#x000A;  + name := USE;&#x000A;&#x000A;Section Public&#x000A;&#x000A;  - accept_object_or_null obj:UNION(USE,NULL) &lt;-&#x000A;  (&#x000A;    obj&#x000A;    .when NULL do { o:NULL;&#x000A;      ? { o.is_null };&#x000A;    }&#x000A;    .when USE do { o:USE;&#x000A;      ? { o.is_null.not };&#x000A;    };&#x000A;  );&#x000A;</code></pre>
</div></div>
          <div class="clear"></div>
        </div>
        <div class="sub-article">
          <h2>
            <a class="permalink" href="../../../Blog/2011/05/02/lysaac_now_compiles_hello_world/index.html">Lysaac now compiles Hello World!</a>
          </h2>
          <div><p class='meta'>
  <span class='date-time'>
    <span class='date'>Mon 02 May 2011,</span>
    <span class='time'>12:04 PM</span>
  </span>
  <span class='tags'>
    <span class='tag'>
      <a class="tag" href="../../comp/index.html">comp</a>
    </span>
    <span class='tag'>
      <a class="tag" href="../index.html">dev</a>
    </span>
    <span class='tag'>
      <a class="tag" href="../../en/index.html">en</a>
    </span>
    <span class='tag'>
      <a class="tag" href="../../lisaac/index.html">lisaac</a>
    </span>
    <span class='tag'>
      <a class="tag" href="../../lysaac/index.html">lysaac</a>
    </span>
  </span>
</p>
<div class="excerpt">
  <p>This is great: Here is the source files:</p>

<p><code>c/cstring.li</code></p>

<pre><code>Section Header&#x000A;&#x000A;  + name := Reference CSTRING;&#x000A;&#x000A;  - role := String; // const char*&#x000A;  - type := Integer 8;&#x000A;</code></pre>

<p><code>c/main.li</code></p>

<pre><code>Section Header&#x000A;&#x000A;  + name := MAIN;&#x000A;&#x000A;Section Public&#x000A;&#x000A;  - puts str:CSTRING &lt;- External `puts`;&#x000A;&#x000A;  - main &lt;-&#x000A;  (&#x000A;    puts "Hello World";&#x000A;  );&#x000A;</code></pre>

<p>You type <code>lysaac compile c &gt;c.bc</code> and you get the following LLVM assembly code:</p>

<p><code>c.bc</code></p>

<pre><code>@0 = private constant [12 x i8] c"Hello World\00"&#x000A;&#x000A;&#x000A;declare void @puts (i8*)&#x000A;&#x000A;define void @main () {&#x000A;  %1 = getelementptr [12 x i8]* @0, i32 0, i32 0&#x000A;  tail call void @puts(i8* %1)&#x000A;  ret void&#x000A;}&#x000A;</code></pre>

<p>And you can execute it using the standard LLVM tools:</p>

<pre><code>$ llvm-as &lt; c.bc | lli&#x000A;Hello World&#x000A;$&#x000A;</code></pre>

<p>Isn't that great ?</p>
</div></div>
          <div class="clear"></div>
        </div>
        <div class="sub-article">
          <h2>
            <a class="permalink" href="../../../Blog/2011/05/09/hmp_http_message_protocol/index.html">HMP: HTTP Message Protocol (0.1)</a>
          </h2>
          <div><p class='meta'>
  <span class='date-time'>
    <span class='date'>Mon 09 May 2011,</span>
    <span class='time'>02:40 PM</span>
  </span>
  <span class='tags'>
    <span class='tag'>
      <a class="tag" href="../../comp/index.html">comp</a>
    </span>
    <span class='tag'>
      <a class="tag" href="../index.html">dev</a>
    </span>
    <span class='tag'>
      <a class="tag" href="../../en/index.html">en</a>
    </span>
  </span>
</p>
<div class="excerpt">
  <h2>FAQ</h2>

<ul>
<li><p><strong>What is HMP:</strong> It is a messaging protocol destined to replace e-mails.</p></li>
<li><p><strong>Why replace e-mails:</strong> Because it is full of spam and unmaintainable. This
alternative is lighter and easier to implement than a full SMTP server with
SPAM management.</p></li>
<li><p><strong>Why use HTTP:</strong> I'm not fan of putting everything over HTTP but it has its
advantages:</p>

<ul>
<li>It has a security layer (HTTPS)</li>
<li>It is (relatively) simple and implemented everywhere</li>
<li>It manages content-types and different types of requests</li>
<li>It is extensible</li>
<li>It goes easily through proxys and NATs</li>
<li>It allows multiplexing many different resources on the same server</li>
</ul>


<p>In the long run, perhaps we should move away from HTTP as:</p>

<ul>
<li>It is too associated with the web</li>
<li>It doesn't allow initiative from the server.</li>
</ul>


<p>WebSockets could be a good alternative one day.</p></li>
<li><p><strong>How do I get my messages:</strong> Not specified, although you could possibly
authenticate using a standard HTTP method to the same resource as your
address and issue a GET command.</p></li>
<li><p><strong>Does this allows a web implementation:</strong> Yes, it will need to be further
specified but if the server detects a browser request (without the HMP
headers) on the resource, it could issue a web-page with a form.</p></li>
<li><p><strong>Is the message format specified</strong>: no, it needs to be. I plan on using
JSON.</p></li>
<li><p><strong>Do you plan an implementation:</strong> Yes, using probably node.js or Lua.</p></li>
<li><p><strong>What prompted this:</strong> The Tor network doesn't have any standard messaging
system. I don't believe SMTP is suited for that.</p></li>
<li><p><strong>Why write this spec, you have no code to back this up:</strong> because I like
writing specs, and it's a way for me to remind me to write the code, and to
tell me how I should write it. I might not get the time to write this as
soon as I want.</p></li>
</ul>


<h2>What is a hmp address</h2>

<p>Scheme:</p>

<pre><code>[hmp:]server[:port][/path]&#x000A;</code></pre>

<p>Example:</p>

<pre><code>hmp:gmail.com:80/user&#x000A;gmail.com:80/user&#x000A;gmail.com/user&#x000A;&#x000A;domain.org/u/alicia&#x000A;</code></pre>

<h2>Translation to HTTPS resources</h2>

<p>A HMP address can directly be translated to an HTTPS resource. The standard
scheme translates to:</p>

<pre><code>https://server:port/path&#x000A;</code></pre>

<h2>Message sending overview</h2>

<p>To send a message from <code>domain.org/alicia</code> to <code>users.net/~bob</code>, the sequence is:</p>

<ul>
<li><p>Connection to users.net:</p>

<pre><code>[1] POST https://users.net/~bob&#x000A;[1] HMP-Pingback: 235&#x000A;[1] HMP-From: domain.org/alicia&#x000A;[1] Content: message-content&#x000A;</code></pre></li>
<li><p>users.net opens a connection to domain.org</p>

<pre><code>[2] GET https://domain.org/alicia&#x000A;[2] HMP-Pingback: 235&#x000A;[2] HMP-Method: MD5&#x000A;</code></pre></li>
<li><p>domain.org responds to users.net</p>

<pre><code>[2] HMP-Hash: ef0167eca19bb2d4c8dfe4c3803cc204&#x000A;[2] Status: 200&#x000A;</code></pre></li>
<li><p>users.net responds to the original sender</p>

<pre><code>[1] Status: 200&#x000A;</code></pre></li>
</ul>


<h2>Headers to the POST request</h2>

<p>The POST request is the request used to post a message. It contains two specific
headers:</p>

<ul>
<li><p>HMP-From: The address the message is sent from</p></li>
<li><p>HMP-Pingback: A sequence number that uniquely identifies the message for the
sender. it needs not be unique, as long as at ont point in time, there are
only one message corresponding to this ID.</p></li>
</ul>


<p>Particular status codes:</p>

<ul>
<li><p>200 in case of success</p></li>
<li><p>403 in case the From address could not be authenticated</p></li>
</ul>


<h2>From address authentication, pingpack</h2>

<p>In order to avoid SPAM, the sender must be authenticated when the message is
sent. For this reason, before accepting or rejecting the request, the server
must initiate a pingback procedure to the sender.</p>

<p>First, the From address is converted to an HTTPS resource and a GET connection
is initiated. The specific request-headers are:</p>

<ul>
<li><p>HMP-Pingback: the pingback sequence number from the previous request</p></li>
<li><p>HMP-Method: method for verifying the originating message. The only specified
method is "MD5"</p></li>
</ul>


<h3>MD5 Method</h3>

<p>In case the message is recognized, the from server responds with the following
header:</p>

<ul>
<li>HMP-Hash: MD5 hash of the content of the message identified by the pingback
identifier</li>
</ul>


<p>The status code can be:</p>

<ul>
<li><p>200 in case the message was recognized</p></li>
<li><p>404 in case the message was not found</p></li>
</ul>


<p>If the MD5 sum corresponds to the message received and a success code was given,
the from is verified and the message can be sent.</p>
</div></div>
          <div class="clear"></div>
        </div>
      </div>
      <div class="page-list">
        <strong>Page:</strong>
        <ul class='page-list'>
          <li>
            <strong>1</strong>
          </li>
          <li>
            <a href="../2/index.html">2</a>
          </li>
          <li>
            <a href="../index.html">latest</a>
          </li>
        </ul>
      </div>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
<include-file src="../../../_footer.html" />
  </body>
</html>
